/*! For license information please see serviceWorker.js.LICENSE.txt */
!function(){"use strict";var t={d:function(e,n){for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})}};t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),t.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},t.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var e={};t.r(e),t.d(e,{Decoder:function(){return En},Encoder:function(){return wn},PacketType:function(){return bn},protocol:function(){return mn}});var n,r,i,o,s=function(){var t=new Date;return"".concat(t.getHours().toString().padStart(2,"0"),":").concat(t.getMinutes().toString().padStart(2,"0"),":").concat(t.getSeconds().toString().padStart(2,"0"))},a=function(t){for(var e,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(e=console).log.apply(e,["[36mINFO[0m ".concat(s(),": ").concat(t)].concat(r))},c=function(t){if("string"!=typeof t)t instanceof Error?console.error("[31mERROR[0m ".concat(s(),":"),t.message):console.error("[31mERROR[0m ".concat(s(),":"),JSON.stringify(t));else{for(var e,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(e=console).error.apply(e,["[31mERROR[0m ".concat(s(),": ").concat(t)].concat(r))}},u=function(t){console.warn("[33mWARN[0m ".concat(s(),": ").concat(t))},h=function(t){return t.AUDIO="audio",t.TRANSCRIPT="transcript",t.AI_INSIGHT="insight",t}({}),l=function(t){return t.MAIN_MESSAGE="message",t.CONNECT="connect",t.DISCONNECT="disconnect",t.CONNECT_ERROR="connect_error",t.ERROR="error",t.RECEIVING="backend-receiving",t.PROCESSING="backend-processing",t.CLOSED="backend-closed",t.SPEECH_END="speech-end",t.SPEECH_START="speech-start",t}({}),f=function(){return f=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},f.apply(this,arguments)};function d(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]])}return n}function p(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function y(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s}function v(t,e,n){if(n||2===arguments.length)for(var r,i=0,o=e.length;i<o;i++)!r&&i in e||(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return t.concat(r||Array.prototype.slice.call(e))}(o=n||(n={})).Start="xstate.start",o.Stop="xstate.stop",o.Raise="xstate.raise",o.Send="xstate.send",o.Cancel="xstate.cancel",o.NullEvent="",o.Assign="xstate.assign",o.After="xstate.after",o.DoneState="done.state",o.DoneInvoke="done.invoke",o.Log="xstate.log",o.Init="xstate.init",o.Invoke="xstate.invoke",o.ErrorExecution="error.execution",o.ErrorCommunication="error.communication",o.ErrorPlatform="error.platform",o.ErrorCustom="xstate.error",o.Update="xstate.update",o.Pure="xstate.pure",o.Choose="xstate.choose",(i=r||(r={})).Parent="#_parent",i.Internal="#_internal";var g,m=n.Start,b=n.Stop,w=n.Raise,S=n.Send,E=n.Cancel,x=n.NullEvent,_=n.Assign,k=(n.After,n.DoneState,n.Log),T=n.Init,O=n.Invoke,N=(n.ErrorExecution,n.ErrorPlatform),A=n.ErrorCustom,R=n.Update,L=n.Choose,I=n.Pure,j={},C="xstate.guard",P=!0;function M(t,e,n){void 0===n&&(n=".");var r=U(t,n),i=U(e,n);return et(i)?!!et(r)&&i===r:et(r)?r in i:Object.keys(r).every((function(t){return t in i&&M(r[t],i[t])}))}function B(t){try{return et(t)||"number"==typeof t?"".concat(t):t.type}catch(t){throw new Error("Events must be strings or objects with a string event.type property.")}}function D(t,e){try{return Z(t)?t:t.toString().split(e)}catch(e){throw new Error("'".concat(t,"' is not a valid state path."))}}function U(t,e){return"object"==typeof(n=t)&&"value"in n&&"context"in n&&"event"in n&&"_event"in n?t.value:Z(t)?F(t):"string"!=typeof t?t:F(D(t,e));var n}function F(t){if(1===t.length)return t[0];for(var e={},n=e,r=0;r<t.length-1;r++)r===t.length-2?n[t[r]]=t[r+1]:(n[t[r]]={},n=n[t[r]]);return e}function V(t,e){for(var n={},r=Object.keys(t),i=0;i<r.length;i++){var o=r[i];n[o]=e(t[o],o,t,i)}return n}function G(t,e,n){var r,i,o={};try{for(var s=p(Object.keys(t)),a=s.next();!a.done;a=s.next()){var c=a.value,u=t[c];n(u)&&(o[c]=e(u,c,t))}}catch(t){r={error:t}}finally{try{a&&!a.done&&(i=s.return)&&i.call(s)}finally{if(r)throw r.error}}return o}var q=function(t){return function(e){var n,r,i=e;try{for(var o=p(t),s=o.next();!s.done;s=o.next())i=i[s.value]}catch(t){n={error:t}}finally{try{s&&!s.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}return i}};function H(t){return t?et(t)?[[t]]:W(Object.keys(t).map((function(e){var n=t[e];return"string"==typeof n||n&&Object.keys(n).length?H(t[e]).map((function(t){return[e].concat(t)})):[[e]]}))):[[]]}function W(t){var e;return(e=[]).concat.apply(e,v([],y(t),!1))}function J(t){return Z(t)?t:[t]}function z(t){return void 0===t?[]:J(t)}function Y(t,e,n){var r,i;if(tt(t))return t(e,n.data);var o={};try{for(var s=p(Object.keys(t)),a=s.next();!a.done;a=s.next()){var c=a.value,u=t[c];tt(u)?o[c]=u(e,n.data):o[c]=u}}catch(t){r={error:t}}finally{try{a&&!a.done&&(i=s.return)&&i.call(s)}finally{if(r)throw r.error}}return o}function $(t){return t instanceof Promise||!(null===t||!tt(t)&&"object"!=typeof t||!tt(t.then))}function K(t,e){return V(t.states,(function(t,n){if(t){var r=(et(e)?void 0:e[n])||(t?t.current:void 0);if(r)return{current:r,states:K(t,r)}}}))}function X(t,e,n,r){P||Q(!!t,"Attempting to update undefined context");var i=t?n.reduce((function(t,n){var i,o,s=n.assignment,a={state:r,action:n,_event:e},c={};if(tt(s))c=s(t,e.data,a);else try{for(var u=p(Object.keys(s)),h=u.next();!h.done;h=u.next()){var l=h.value,f=s[l];c[l]=tt(f)?f(t,e.data,a):f}}catch(t){i={error:t}}finally{try{h&&!h.done&&(o=u.return)&&o.call(u)}finally{if(i)throw i.error}}return Object.assign({},t,c)}),t):t;return i}var Q=function(){};function Z(t){return Array.isArray(t)}function tt(t){return"function"==typeof t}function et(t){return"string"==typeof t}function nt(t,e){if(t)return et(t)?{type:C,name:t,predicate:e?e[t]:void 0}:tt(t)?{type:C,name:t.name,predicate:t}:t}P||(Q=function(t,e){var n=t instanceof Error?t:void 0;if((n||!t)&&void 0!==console){var r=["Warning: ".concat(e)];n&&r.push(n),console.warn.apply(console,r)}});var rt=function(){return"function"==typeof Symbol&&Symbol.observable||"@@observable"}();function it(t){return!!t&&"__xstatenode"in t}function ot(t,e){return et(t)||"number"==typeof t?f({type:t},e):t}function st(t,e){if(!et(t)&&"$$type"in t&&"scxml"===t.$$type)return t;var n=ot(t);return f({name:n.type,data:n,$$type:"scxml",type:"external"},e)}function at(t,e){return J(e).map((function(e){return void 0===e||"string"==typeof e||it(e)?{target:e,event:t}:f(f({},e),{event:t})}))}function ct(t,e,n,r,i){var o=t.options.guards,s={state:i,cond:e,_event:r};if(e.type===C)return((null==o?void 0:o[e.name])||e.predicate)(n,r.data,s);var a=null==o?void 0:o[e.type];if(!a)throw new Error("Guard '".concat(e.type,"' is not implemented on machine '").concat(t.id,"'."));return a(n,r.data,s)}function ut(t){return"string"==typeof t?{type:t}:t}function ht(t,e,n){var r=function(){},i="object"==typeof t,o=i?t:null;return{next:((i?t.next:t)||r).bind(o),error:((i?t.error:e)||r).bind(o),complete:((i?t.complete:n)||r).bind(o)}}function lt(t,e){return"".concat(t,":invocation[").concat(e,"]")}function ft(t){return(t.type===w||t.type===S&&t.to===r.Internal)&&"number"!=typeof t.delay}(g={})[rt]=function(){return this},g[Symbol.observable]=function(){return this};var dt=function(t){return"atomic"===t.type||"final"===t.type};function pt(t){return Object.keys(t.states).map((function(e){return t.states[e]}))}function yt(t){return pt(t).filter((function(t){return"history"!==t.type}))}function vt(t){var e=[t];return dt(t)?e:e.concat(W(yt(t).map(vt)))}function gt(t,e){var n,r,i,o,s,a,c,u,h=bt(new Set(t)),l=new Set(e);try{for(var f=p(l),d=f.next();!d.done;d=f.next())for(var y=(_=d.value).parent;y&&!l.has(y);)l.add(y),y=y.parent}catch(t){n={error:t}}finally{try{d&&!d.done&&(r=f.return)&&r.call(f)}finally{if(n)throw n.error}}var v=bt(l);try{for(var g=p(l),m=g.next();!m.done;m=g.next())if("compound"!==(_=m.value).type||v.get(_)&&v.get(_).length){if("parallel"===_.type)try{for(var b=(s=void 0,p(yt(_))),w=b.next();!w.done;w=b.next()){var S=w.value;l.has(S)||(l.add(S),h.get(S)?h.get(S).forEach((function(t){return l.add(t)})):S.initialStateNodes.forEach((function(t){return l.add(t)})))}}catch(t){s={error:t}}finally{try{w&&!w.done&&(a=b.return)&&a.call(b)}finally{if(s)throw s.error}}}else h.get(_)?h.get(_).forEach((function(t){return l.add(t)})):_.initialStateNodes.forEach((function(t){return l.add(t)}))}catch(t){i={error:t}}finally{try{m&&!m.done&&(o=g.return)&&o.call(g)}finally{if(i)throw i.error}}try{for(var E=p(l),x=E.next();!x.done;x=E.next()){var _;for(y=(_=x.value).parent;y&&!l.has(y);)l.add(y),y=y.parent}}catch(t){c={error:t}}finally{try{x&&!x.done&&(u=E.return)&&u.call(E)}finally{if(c)throw c.error}}return l}function mt(t,e){var n=e.get(t);if(!n)return{};if("compound"===t.type){var r=n[0];if(!r)return{};if(dt(r))return r.key}var i={};return n.forEach((function(t){i[t.key]=mt(t,e)})),i}function bt(t){var e,n,r=new Map;try{for(var i=p(t),o=i.next();!o.done;o=i.next()){var s=o.value;r.has(s)||r.set(s,[]),s.parent&&(r.has(s.parent)||r.set(s.parent,[]),r.get(s.parent).push(s))}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}function wt(t,e){return mt(t,bt(gt([t],e)))}function St(t,e){return Array.isArray(t)?t.some((function(t){return t===e})):t instanceof Set&&t.has(e)}function Et(t,e){return"compound"===e.type?yt(e).some((function(e){return"final"===e.type&&St(t,e)})):"parallel"===e.type&&yt(e).every((function(e){return Et(t,e)}))}function xt(t){return new Set(W(t.map((function(t){return t.tags}))))}var _t=st({type:T});function kt(t,e){return e&&e[t]||void 0}function Tt(t,e){var n;if(et(t)||"number"==typeof t)n=tt(r=kt(t,e))?{type:t,exec:r}:r||{type:t,exec:void 0};else if(tt(t))n={type:t.name||t.toString(),exec:t};else{var r;if(tt(r=kt(t.type,e)))n=f(f({},t),{exec:r});else if(r){var i=r.type||t.type;n=f(f(f({},r),t),{type:i})}else n=t}return n}var Ot=function(t,e){return t?(Z(t)?t:[t]).map((function(t){return Tt(t,e)})):[]};function Nt(t){var e=Tt(t);return f(f({id:et(t)?t:e.id},e),{type:e.type})}function At(t,e){return{type:w,event:"function"==typeof t?t:ot(t),delay:e?e.delay:void 0,id:null==e?void 0:e.id}}var Rt=function(t,e){return{context:t,event:e}};function Lt(t,e){var r="".concat(n.DoneState,".").concat(t);return{type:r,data:e,toString:function(){return r}}}function It(t,e){var r="".concat(n.DoneInvoke,".").concat(t);return{type:r,data:e,toString:function(){return r}}}function jt(t,e){var r="".concat(n.ErrorPlatform,".").concat(t);return{type:r,data:e,toString:function(){return r}}}function Ct(t,e,i,o,s,a,c){void 0===c&&(c=!1);var u=c?[]:function(t){var e,n,r=[];try{for(var i=p(t),o=i.next();!o.done;o=i.next())for(var s=o.value,a=0;a<s.actions.length;)s.actions[a].type!==_?a++:(r.push(s.actions[a]),s.actions.splice(a,1))}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}(s),h=u.length?X(i,o,u,e):i,l=c?[i]:void 0,d=[];function g(s,u){var p;switch(u.type){case w:var g=function(t,e,n,r){var i,o={_event:n},s=st(tt(t.event)?t.event(e,n.data,o):t.event);if(et(t.delay)){var a=r&&r[t.delay];i=tt(a)?a(e,n.data,o):a}else i=tt(t.delay)?t.delay(e,n.data,o):t.delay;return f(f({},t),{type:w,_event:s,delay:i})}(u,h,o,t.options.delays);return a&&"number"==typeof g.delay&&a(g,h,o),g;case S:var m=function(t,e,n,r){var i,o={_event:n},s=st(tt(t.event)?t.event(e,n.data,o):t.event);if(et(t.delay)){var a=r&&r[t.delay];i=tt(a)?a(e,n.data,o):a}else i=tt(t.delay)?t.delay(e,n.data,o):t.delay;var c=tt(t.to)?t.to(e,n.data,o):t.to;return f(f({},t),{to:c,_event:s,event:s.data,delay:i})}(u,h,o,t.options.delays);if(!P){var E=u.delay;Q(!et(E)||"number"==typeof m.delay,"No delay reference for delay expression '".concat(E,"' was found on machine '").concat(t.id,"'"))}return a&&m.to!==r.Internal&&("entry"===s?d.push(m):a(m,h,o)),m;case k:var x=function(t,e,n){return f(f({},t),{value:et(t.expr)?t.expr:t.expr(e,n.data,{_event:n})})}(u,h,o);return null==a||a(x,h,o),x;case L:if(!(A=null===(p=u.conds.find((function(n){var r=nt(n.cond,t.options.guards);return!r||ct(t,r,h,o,a?void 0:e)})))||void 0===p?void 0:p.actions))return[];var T=y(Ct(t,e,h,o,[{type:s,actions:Ot(z(A),t.options.actions)}],a,c),2),O=T[0],N=T[1];return h=N,null==l||l.push(h),O;case I:var A;if(!(A=u.get(h,o.data)))return[];var R=y(Ct(t,e,h,o,[{type:s,actions:Ot(z(A),t.options.actions)}],a,c),2),j=R[0],C=R[1];return h=C,null==l||l.push(h),j;case b:return x=function(t,e,r){var i=tt(t.activity)?t.activity(e,r.data):t.activity,o="string"==typeof i?{id:i}:i;return{type:n.Stop,activity:o}}(u,h,o),null==a||a(x,i,o),x;case _:h=X(h,o,[u],a?void 0:e),null==l||l.push(h);break;default:var M=Tt(u,t.options.actions),B=M.exec;if(a)a(M,h,o);else if(B&&l){var D=l.length-1,U=f(f({},M),{exec:function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];B.apply(void 0,v([l[D]],y(e),!1))}});M=U}return M}}var m=W(s.map((function(t){var e,n,r=[];try{for(var i=p(t.actions),s=i.next();!s.done;s=i.next()){var c=s.value,u=g(t.type,c);u&&(r=r.concat(u))}}catch(t){e={error:t}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return d.forEach((function(t){a(t,h,o)})),d.length=0,r})));return[m,h]}function Pt(t,e){if(t===e)return!0;if(void 0===t||void 0===e)return!1;if(et(t)||et(e))return t===e;var n=Object.keys(t),r=Object.keys(e);return n.length===r.length&&n.every((function(n){return Pt(t[n],e[n])}))}var Mt=function(){function t(t){var e,n,r=this;this.actions=[],this.activities=j,this.meta={},this.events=[],this.value=t.value,this.context=t.context,this._event=t._event,this._sessionid=t._sessionid,this.event=this._event.data,this.historyValue=t.historyValue,this.history=t.history,this.actions=t.actions||[],this.activities=t.activities||j,this.meta=(void 0===(n=t.configuration)&&(n=[]),n.reduce((function(t,e){return void 0!==e.meta&&(t[e.id]=e.meta),t}),{})),this.events=t.events||[],this.matches=this.matches.bind(this),this.toStrings=this.toStrings.bind(this),this.configuration=t.configuration,this.transitions=t.transitions,this.children=t.children,this.done=!!t.done,this.tags=null!==(e=Array.isArray(t.tags)?new Set(t.tags):t.tags)&&void 0!==e?e:new Set,this.machine=t.machine,Object.defineProperty(this,"nextEvents",{get:function(){return function(t){return v([],y(new Set(W(v([],y(t.map((function(t){return t.ownEvents}))),!1)))),!1)}(r.configuration)}})}return t.from=function(e,n){return e instanceof t?e.context!==n?new t({value:e.value,context:n,_event:e._event,_sessionid:null,historyValue:e.historyValue,history:e.history,actions:[],activities:e.activities,meta:{},events:[],configuration:[],transitions:[],children:{}}):e:new t({value:e,context:n,_event:_t,_sessionid:null,historyValue:void 0,history:void 0,actions:[],activities:void 0,meta:void 0,events:[],configuration:[],transitions:[],children:{}})},t.create=function(e){return new t(e)},t.inert=function(e,n){if(e instanceof t){if(!e.actions.length)return e;var r=_t;return new t({value:e.value,context:n,_event:r,_sessionid:null,historyValue:e.historyValue,history:e.history,activities:e.activities,configuration:e.configuration,transitions:[],children:{}})}return t.from(e,n)},t.prototype.toStrings=function(t,e){var n=this;if(void 0===t&&(t=this.value),void 0===e&&(e="."),et(t))return[t];var r=Object.keys(t);return r.concat.apply(r,v([],y(r.map((function(r){return n.toStrings(t[r],e).map((function(t){return r+e+t}))}))),!1))},t.prototype.toJSON=function(){var t=this;t.configuration,t.transitions;var e=t.tags;t.machine;var n=d(t,["configuration","transitions","tags","machine"]);return f(f({},n),{tags:Array.from(e)})},t.prototype.matches=function(t){return M(t,this.value)},t.prototype.hasTag=function(t){return this.tags.has(t)},t.prototype.can=function(t){var e;P&&Q(!!this.machine,"state.can(...) used outside of a machine-created State object; this will always return false.");var n=null===(e=this.machine)||void 0===e?void 0:e.getTransitionData(this,t);return!!(null==n?void 0:n.transitions.length)&&n.transitions.some((function(t){return void 0!==t.target||t.actions.length}))},t}(),Bt=[],Dt=function(t,e){Bt.push(t);var n=e(t);return Bt.pop(),n};function Ut(t){var e;return(e={id:t,send:function(){},subscribe:function(){return{unsubscribe:function(){}}},getSnapshot:function(){},toJSON:function(){return{id:t}}})[rt]=function(){return this},e}function Ft(t,e,n){var r=Ut(e);if(r.deferred=!0,it(t)){var i=r.state=Dt(void 0,(function(){return(n?t.withContext(n):t).initialState}));r.getSnapshot=function(){return i}}return r}function Vt(t){return f(f({type:O},t),{toJSON:function(){t.onDone,t.onError;var e,n=d(t,["onDone","onError"]);return f(f({},n),{type:O,src:(e=t.src,"string"==typeof e?{type:e,toString:function(){return e}}:e)})}})}var Gt="",qt="*",Ht={},Wt=function(t){return"#"===t[0]},Jt=function(){function t(e,n,r,i){void 0===r&&(r="context"in e?e.context:void 0);var o,s=this;this.config=e,this._context=r,this.order=-1,this.__xstatenode=!0,this.__cache={events:void 0,relativeValue:new Map,initialStateValue:void 0,initialState:void 0,on:void 0,transitions:void 0,candidates:{},delayedTransitions:void 0},this.idMap={},this.tags=[],this.options=Object.assign({actions:{},guards:{},services:{},activities:{},delays:{}},n),this.parent=null==i?void 0:i.parent,this.key=this.config.key||(null==i?void 0:i.key)||this.config.id||"(machine)",this.machine=this.parent?this.parent.machine:this,this.path=this.parent?this.parent.path.concat(this.key):[],this.delimiter=this.config.delimiter||(this.parent?this.parent.delimiter:"."),this.id=this.config.id||v([this.machine.key],y(this.path),!1).join(this.delimiter),this.version=this.parent?this.parent.version:this.config.version,this.type=this.config.type||(this.config.parallel?"parallel":this.config.states&&Object.keys(this.config.states).length?"compound":this.config.history?"history":"atomic"),this.schema=this.parent?this.machine.schema:null!==(o=this.config.schema)&&void 0!==o?o:{},this.description=this.config.description,P||Q(!("parallel"in this.config),'The "parallel" property is deprecated and will be removed in version 4.1. '.concat(this.config.parallel?"Replace with `type: 'parallel'`":"Use `type: '".concat(this.type,"'`")," in the config for state node '").concat(this.id,"' instead.")),this.initial=this.config.initial,this.states=this.config.states?V(this.config.states,(function(e,n){var r,i=new t(e,{},void 0,{parent:s,key:n});return Object.assign(s.idMap,f(((r={})[i.id]=i,r),i.idMap)),i})):Ht;var a=0;!function t(e){var n,r;e.order=a++;try{for(var i=p(pt(e)),o=i.next();!o.done;o=i.next())t(o.value)}catch(t){n={error:t}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}}(this),this.history=!0===this.config.history?"shallow":this.config.history||!1,this._transient=!!this.config.always||!!this.config.on&&(Array.isArray(this.config.on)?this.config.on.some((function(t){return t.event===Gt})):Gt in this.config.on),this.strict=!!this.config.strict,this.onEntry=z(this.config.entry||this.config.onEntry).map((function(t){return Tt(t)})),this.onExit=z(this.config.exit||this.config.onExit).map((function(t){return Tt(t)})),this.meta=this.config.meta,this.doneData="final"===this.type?this.config.data:void 0,this.invoke=z(this.config.invoke).map((function(t,e){var n,r;if(it(t)){var i=lt(s.id,e);return s.machine.options.services=f(((n={})[i]=t,n),s.machine.options.services),Vt({src:i,id:i})}if(et(t.src))return i=t.id||lt(s.id,e),Vt(f(f({},t),{id:i,src:t.src}));if(it(t.src)||tt(t.src))return i=t.id||lt(s.id,e),s.machine.options.services=f(((r={})[i]=t.src,r),s.machine.options.services),Vt(f(f({id:i},t),{src:i}));var o=t.src;return Vt(f(f({id:lt(s.id,e)},t),{src:o}))})),this.activities=z(this.config.activities).concat(this.invoke).map((function(t){return Nt(t)})),this.transition=this.transition.bind(this),this.tags=z(this.config.tags)}return t.prototype._init=function(){this.__cache.transitions||vt(this).forEach((function(t){return t.on}))},t.prototype.withConfig=function(e,n){var r=this.options,i=r.actions,o=r.activities,s=r.guards,a=r.services,c=r.delays;return new t(this.config,{actions:f(f({},i),e.actions),activities:f(f({},o),e.activities),guards:f(f({},s),e.guards),services:f(f({},a),e.services),delays:f(f({},c),e.delays)},null!=n?n:this.context)},t.prototype.withContext=function(e){return new t(this.config,this.options,e)},Object.defineProperty(t.prototype,"context",{get:function(){return tt(this._context)?this._context():this._context},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"definition",{get:function(){return{id:this.id,key:this.key,version:this.version,context:this.context,type:this.type,initial:this.initial,history:this.history,states:V(this.states,(function(t){return t.definition})),on:this.on,transitions:this.transitions,entry:this.onEntry,exit:this.onExit,activities:this.activities||[],meta:this.meta,order:this.order||-1,data:this.doneData,invoke:this.invoke,description:this.description,tags:this.tags}},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return this.definition},Object.defineProperty(t.prototype,"on",{get:function(){if(this.__cache.on)return this.__cache.on;var t=this.transitions;return this.__cache.on=t.reduce((function(t,e){return t[e.eventType]=t[e.eventType]||[],t[e.eventType].push(e),t}),{})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"after",{get:function(){return this.__cache.delayedTransitions||(this.__cache.delayedTransitions=this.getDelayedTransitions(),this.__cache.delayedTransitions)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"transitions",{get:function(){return this.__cache.transitions||(this.__cache.transitions=this.formatTransitions(),this.__cache.transitions)},enumerable:!1,configurable:!0}),t.prototype.getCandidates=function(t){if(this.__cache.candidates[t])return this.__cache.candidates[t];var e=t===Gt,n=this.transitions.filter((function(n){var r=n.eventType===t;return e?r:r||n.eventType===qt}));return this.__cache.candidates[t]=n,n},t.prototype.getDelayedTransitions=function(){var t=this,e=this.config.after;if(!e)return[];var r=function(e,r){var i,o,s,a=(i=tt(e)?"".concat(t.id,":delay[").concat(r,"]"):e,o=t.id,s=o?"#".concat(o):"","".concat(n.After,"(").concat(i,")").concat(s));return t.onEntry.push(function(t,e){return{to:e?e.to:void 0,type:S,event:tt(t)?t:ot(t),delay:e?e.delay:void 0,id:e&&void 0!==e.id?e.id:tt(t)?t.name:B(t)}}(a,{delay:e})),t.onExit.push({type:E,sendId:a}),a},i=Z(e)?e.map((function(t,e){var n=r(t.delay,e);return f(f({},t),{event:n})})):W(Object.keys(e).map((function(t,n){var i=e[t],o=et(i)?{target:i}:i,s=isNaN(+t)?t:+t,a=r(s,n);return z(o).map((function(t){return f(f({},t),{event:a,delay:s})}))})));return i.map((function(e){var n=e.delay;return f(f({},t.formatTransition(e)),{delay:n})}))},t.prototype.getStateNodes=function(t){var e,n=this;if(!t)return[];var r=t instanceof Mt?t.value:U(t,this.delimiter);if(et(r)){var i=this.getStateNode(r).initial;return void 0!==i?this.getStateNodes(((e={})[r]=i,e)):[this,this.states[r]]}var o=Object.keys(r),s=[this];return s.push.apply(s,v([],y(W(o.map((function(t){return n.getStateNode(t).getStateNodes(r[t])})))),!1)),s},t.prototype.handles=function(t){var e=B(t);return this.events.includes(e)},t.prototype.resolveState=function(t){var e=t instanceof Mt?t:Mt.create(t),n=Array.from(gt([],this.getStateNodes(e.value)));return new Mt(f(f({},e),{value:this.resolve(e.value),configuration:n,done:Et(n,this),tags:xt(n),machine:this.machine}))},t.prototype.transitionLeafNode=function(t,e,n){var r=this.getStateNode(t).next(e,n);return r&&r.transitions.length?r:this.next(e,n)},t.prototype.transitionCompoundNode=function(t,e,n){var r=Object.keys(t),i=this.getStateNode(r[0])._transition(t[r[0]],e,n);return i&&i.transitions.length?i:this.next(e,n)},t.prototype.transitionParallelNode=function(t,e,n){var r,i,o={};try{for(var s=p(Object.keys(t)),a=s.next();!a.done;a=s.next()){var c=a.value,u=t[c];if(u){var h=this.getStateNode(c)._transition(u,e,n);h&&(o[c]=h)}}}catch(t){r={error:t}}finally{try{a&&!a.done&&(i=s.return)&&i.call(s)}finally{if(r)throw r.error}}var l=Object.keys(o).map((function(t){return o[t]})),f=W(l.map((function(t){return t.transitions})));if(!l.some((function(t){return t.transitions.length>0})))return this.next(e,n);var d=W(Object.keys(o).map((function(t){return o[t].configuration})));return{transitions:f,exitSet:W(l.map((function(t){return t.exitSet}))),configuration:d,source:e,actions:W(Object.keys(o).map((function(t){return o[t].actions})))}},t.prototype._transition=function(t,e,n){return et(t)?this.transitionLeafNode(t,e,n):1===Object.keys(t).length?this.transitionCompoundNode(t,e,n):this.transitionParallelNode(t,e,n)},t.prototype.getTransitionData=function(t,e){return this._transition(t.value,t,st(e))},t.prototype.next=function(t,e){var n,r,i,o=this,s=e.name,a=[],c=[];try{for(var u=p(this.getCandidates(s)),h=u.next();!h.done;h=u.next()){var l=h.value,f=l.cond,d=l.in,g=t.context,m=!d||(et(d)&&Wt(d)?t.matches(U(this.getStateNodeById(d).path,this.delimiter)):M(U(d,this.delimiter),q(this.path.slice(0,-2))(t.value))),b=!1;try{b=!f||ct(this.machine,f,g,e,t)}catch(t){throw new Error("Unable to evaluate guard '".concat(f.name||f.type,"' in transition for event '").concat(s,"' in state node '").concat(this.id,"':\n").concat(t.message))}if(b&&m){void 0!==l.target&&(c=l.target),a.push.apply(a,v([],y(l.actions),!1)),i=l;break}}}catch(t){n={error:t}}finally{try{h&&!h.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}if(i){if(!c.length)return{transitions:[i],exitSet:[],configuration:t.value?[this]:[],source:t,actions:a};var w=W(c.map((function(e){return o.getRelativeStateNodes(e,t.historyValue)})));return{transitions:[i],exitSet:i.internal?[]:W(c.map((function(t){return o.getPotentiallyReenteringNodes(t)}))),configuration:w,source:t,actions:a}}},t.prototype.getPotentiallyReenteringNodes=function(t){if(this.order<t.order)return[this];for(var e=[],n=this,r=t;n&&n!==r;)e.push(n),n=n.parent;return n!==r?[]:(e.push(r),e)},t.prototype.getActions=function(t,e,r,i,o,s,a){var c,u,h,l,f=this,d=s?gt([],this.getStateNodes(s.value)):[],g=new Set;try{for(var m=p(Array.from(t).sort((function(t,e){return t.order-e.order}))),b=m.next();!b.done;b=m.next())(!St(d,E=b.value)||St(r.exitSet,E)||E.parent&&g.has(E.parent))&&g.add(E)}catch(t){c={error:t}}finally{try{b&&!b.done&&(u=m.return)&&u.call(m)}finally{if(c)throw c.error}}try{for(var w=p(d),S=w.next();!S.done;S=w.next()){var E;St(t,E=S.value)&&!St(r.exitSet,E.parent)||r.exitSet.push(E)}}catch(t){h={error:t}}finally{try{S&&!S.done&&(l=w.return)&&l.call(w)}finally{if(h)throw h.error}}r.exitSet.sort((function(t,e){return e.order-t.order}));var x=Array.from(g).sort((function(t,e){return t.order-e.order})),_=new Set(r.exitSet),k=W(x.map((function(t){var e=[];if("final"!==t.type)return e;var n=t.parent;if(!n.parent)return e;e.push(Lt(t.id,t.doneData),Lt(n.id,t.doneData?Y(t.doneData,i,o):void 0));var s=n.parent;return"parallel"===s.type&&yt(s).every((function(t){return Et(r.configuration,t)}))&&e.push(Lt(s.id)),e}))),T=x.map((function(t){var e=t.onEntry,r=t.activities.map((function(t){return function(t){var e=Nt(t);return{type:n.Start,activity:e,exec:void 0}}(t)}));return{type:"entry",actions:Ot(a?v(v([],y(e),!1),y(r),!1):v(v([],y(r),!1),y(e),!1),f.machine.options.actions)}})).concat({type:"state_done",actions:k.map((function(t){return At(t)}))}),O=Array.from(_).map((function(t){return{type:"exit",actions:Ot(v(v([],y(t.onExit),!1),y(t.activities.map((function(t){return function(t){var e=tt(t)?t:Nt(t);return{type:n.Stop,activity:e,exec:void 0}}(t)}))),!1),f.machine.options.actions)}})).concat({type:"transition",actions:Ot(r.actions,this.machine.options.actions)}).concat(T);if(e){var N=Ot(W(v([],y(t),!1).sort((function(t,e){return e.order-t.order})).map((function(t){return t.onExit}))),this.machine.options.actions).filter((function(t){return!ft(t)}));return O.concat({type:"stop",actions:N})}return O},t.prototype.transition=function(t,e,n,r){void 0===t&&(t=this.initialState);var i,o,s=st(e);if(t instanceof Mt)i=void 0===n?t:this.resolveState(Mt.from(t,n));else{var a=et(t)?this.resolve(F(this.getResolvedPath(t))):this.resolve(t),c=null!=n?n:this.machine.context;i=this.resolveState(Mt.from(a,c))}if(!P&&s.name===qt)throw new Error("An event cannot have the wildcard type ('".concat(qt,"')"));if(this.strict&&!this.events.includes(s.name)&&(o=s.name,!/^(done|error)\./.test(o)))throw new Error("Machine '".concat(this.id,"' does not accept event '").concat(s.name,"'"));var u=this._transition(i.value,i,s)||{transitions:[],configuration:[],exitSet:[],source:i,actions:[]},h=gt([],this.getStateNodes(i.value)),l=u.configuration.length?gt(h,u.configuration):h;return u.configuration=v([],y(l),!1),this.resolveTransition(u,i,i.context,r,s)},t.prototype.resolveRaisedTransition=function(t,e,n,r){var i,o=t.actions;return(t=this.transition(t,e,void 0,r))._event=n,t.event=n.data,(i=t.actions).unshift.apply(i,v([],y(o),!1)),t},t.prototype.resolveTransition=function(t,e,n,r,i){var o,s,a,c,u=this;void 0===i&&(i=_t);var h=t.configuration,l=!e||t.transitions.length>0,d=l?t.configuration:e?e.configuration:[],v=Et(d,this),g=l?wt(this.machine,h):void 0,w=e?e.historyValue?e.historyValue:t.source?this.machine.historyValue(e.value):void 0:void 0,S=this.getActions(new Set(d),v,t,n,i,e,r),E=e?f({},e.activities):{};try{for(var _=p(S),k=_.next();!k.done;k=_.next()){var T=k.value;try{for(var N=(a=void 0,p(T.actions)),A=N.next();!A.done;A=N.next()){var L=A.value;L.type===m?E[L.activity.id||L.activity.type]=L:L.type===b&&(E[L.activity.id||L.activity.type]=!1)}}catch(t){a={error:t}}finally{try{A&&!A.done&&(c=N.return)&&c.call(N)}finally{if(a)throw a.error}}}}catch(t){o={error:t}}finally{try{k&&!k.done&&(s=_.return)&&s.call(_)}finally{if(o)throw o.error}}var I,j,C=y(Ct(this,e,n,i,S,r,this.machine.config.predictableActionArguments||this.machine.config.preserveActionOrder),2),P=C[0],M=C[1],B=y(function(t,e){var n,r,i=y([[],[]],2),o=i[0],s=i[1];try{for(var a=p(t),c=a.next();!c.done;c=a.next()){var u=c.value;e(u)?o.push(u):s.push(u)}}catch(t){n={error:t}}finally{try{c&&!c.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return[o,s]}(P,ft),2),D=B[0],U=B[1],F=P.filter((function(t){var e;return t.type===m&&(null===(e=t.activity)||void 0===e?void 0:e.type)===O})),V=F.reduce((function(t,e){return t[e.activity.id]=function(t,e,n,r){var i,o=ut(t.src),s=null===(i=null==e?void 0:e.options.services)||void 0===i?void 0:i[o.type],a=t.data?Y(t.data,n,r):void 0,c=s?Ft(s,t.id,a):Ut(t.id);return c.meta=t,c}(e.activity,u.machine,M,i),t}),e?f({},e.children):{}),G=new Mt({value:g||e.value,context:M,_event:i,_sessionid:e?e._sessionid:null,historyValue:g?w?(I=w,j=g,{current:j,states:K(I,j)}):void 0:e?e.historyValue:void 0,history:!g||t.source?e:void 0,actions:g?U:[],activities:g?E:e?e.activities:{},events:[],configuration:d,transitions:t.transitions,children:V,done:v,tags:xt(d),machine:this}),q=n!==M;G.changed=i.name===R||q;var H=G.history;H&&delete H.history;var W=!v&&(this._transient||h.some((function(t){return t._transient})));if(!(l||W&&i.name!==Gt))return G;var J=G;if(!v)for(W&&(J=this.resolveRaisedTransition(J,{type:x},i,r));D.length;){var z=D.shift();J=this.resolveRaisedTransition(J,z._event,i,r)}var $=J.changed||(H?!!J.actions.length||q||typeof H.value!=typeof J.value||!Pt(J.value,H.value):void 0);return J.changed=$,J.history=H,J},t.prototype.getStateNode=function(t){if(Wt(t))return this.machine.getStateNodeById(t);if(!this.states)throw new Error("Unable to retrieve child state '".concat(t,"' from '").concat(this.id,"'; no child states exist."));var e=this.states[t];if(!e)throw new Error("Child state '".concat(t,"' does not exist on '").concat(this.id,"'"));return e},t.prototype.getStateNodeById=function(t){var e=Wt(t)?t.slice(1):t;if(e===this.id)return this;var n=this.machine.idMap[e];if(!n)throw new Error("Child state node '#".concat(e,"' does not exist on machine '").concat(this.id,"'"));return n},t.prototype.getStateNodeByPath=function(t){if("string"==typeof t&&Wt(t))try{return this.getStateNodeById(t.slice(1))}catch(t){}for(var e=D(t,this.delimiter).slice(),n=this;e.length;){var r=e.shift();if(!r.length)break;n=n.getStateNode(r)}return n},t.prototype.resolve=function(t){var e,n=this;if(!t)return this.initialStateValue||Ht;switch(this.type){case"parallel":return V(this.initialStateValue,(function(e,r){return e?n.getStateNode(r).resolve(t[r]||e):Ht}));case"compound":if(et(t)){var r=this.getStateNode(t);return"parallel"===r.type||"compound"===r.type?((e={})[t]=r.initialStateValue,e):t}return Object.keys(t).length?V(t,(function(t,e){return t?n.getStateNode(e).resolve(t):Ht})):this.initialStateValue||{};default:return t||Ht}},t.prototype.getResolvedPath=function(t){if(Wt(t)){var e=this.machine.idMap[t.slice(1)];if(!e)throw new Error("Unable to find state node '".concat(t,"'"));return e.path}return D(t,this.delimiter)},Object.defineProperty(t.prototype,"initialStateValue",{get:function(){var t,e;if(this.__cache.initialStateValue)return this.__cache.initialStateValue;if("parallel"===this.type)e=G(this.states,(function(t){return t.initialStateValue||Ht}),(function(t){return!("history"===t.type)}));else if(void 0!==this.initial){if(!this.states[this.initial])throw new Error("Initial state '".concat(this.initial,"' not found on '").concat(this.key,"'"));e=dt(this.states[this.initial])?this.initial:((t={})[this.initial]=this.states[this.initial].initialStateValue,t)}else e={};return this.__cache.initialStateValue=e,this.__cache.initialStateValue},enumerable:!1,configurable:!0}),t.prototype.getInitialState=function(t,e){this._init();var n=this.getStateNodes(t);return this.resolveTransition({configuration:n,exitSet:[],transitions:[],source:void 0,actions:[]},void 0,null!=e?e:this.machine.context,void 0)},Object.defineProperty(t.prototype,"initialState",{get:function(){var t=this.initialStateValue;if(!t)throw new Error("Cannot retrieve initial state from simple state '".concat(this.id,"'."));return this.getInitialState(t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"target",{get:function(){var t;if("history"===this.type){var e=this.config;t=et(e.target)&&Wt(e.target)?F(this.machine.getStateNodeById(e.target).path.slice(this.path.length-1)):e.target}return t},enumerable:!1,configurable:!0}),t.prototype.getRelativeStateNodes=function(t,e,n){return void 0===n&&(n=!0),n?"history"===t.type?t.resolveHistory(e):t.initialStateNodes:[t]},Object.defineProperty(t.prototype,"initialStateNodes",{get:function(){var t=this;return dt(this)?[this]:"compound"!==this.type||this.initial?W(H(this.initialStateValue).map((function(e){return t.getFromRelativePath(e)}))):(P||Q(!1,"Compound state node '".concat(this.id,"' has no initial state.")),[this])},enumerable:!1,configurable:!0}),t.prototype.getFromRelativePath=function(t){if(!t.length)return[this];var e=y(t),n=e[0],r=e.slice(1);if(!this.states)throw new Error("Cannot retrieve subPath '".concat(n,"' from node with no states"));var i=this.getStateNode(n);if("history"===i.type)return i.resolveHistory();if(!this.states[n])throw new Error("Child state '".concat(n,"' does not exist on '").concat(this.id,"'"));return this.states[n].getFromRelativePath(r)},t.prototype.historyValue=function(t){if(Object.keys(this.states).length)return{current:t||this.initialStateValue,states:G(this.states,(function(e,n){if(!t)return e.historyValue();var r=et(t)?void 0:t[n];return e.historyValue(r||e.initialStateValue)}),(function(t){return!t.history}))}},t.prototype.resolveHistory=function(t){var e=this;if("history"!==this.type)return[this];var n=this.parent;if(!t){var r=this.target;return r?W(H(r).map((function(t){return n.getFromRelativePath(t)}))):n.initialStateNodes}var i,o=(i=n.path,"states",function(t){var e,n,r=t;try{for(var o=p(i),s=o.next();!s.done;s=o.next()){var a=s.value;r=r.states[a]}}catch(t){e={error:t}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}return r})(t).current;return et(o)?[n.getStateNode(o)]:W(H(o).map((function(t){return"deep"===e.history?n.getFromRelativePath(t):[n.states[t[0]]]})))},Object.defineProperty(t.prototype,"stateIds",{get:function(){var t=this,e=W(Object.keys(this.states).map((function(e){return t.states[e].stateIds})));return[this.id].concat(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"events",{get:function(){var t,e,n,r;if(this.__cache.events)return this.__cache.events;var i=this.states,o=new Set(this.ownEvents);if(i)try{for(var s=p(Object.keys(i)),a=s.next();!a.done;a=s.next()){var c=i[a.value];if(c.states)try{for(var u=(n=void 0,p(c.events)),h=u.next();!h.done;h=u.next()){var l=h.value;o.add("".concat(l))}}catch(t){n={error:t}}finally{try{h&&!h.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}}}catch(e){t={error:e}}finally{try{a&&!a.done&&(e=s.return)&&e.call(s)}finally{if(t)throw t.error}}return this.__cache.events=Array.from(o)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ownEvents",{get:function(){var t=new Set(this.transitions.filter((function(t){return!(!t.target&&!t.actions.length&&t.internal)})).map((function(t){return t.eventType})));return Array.from(t)},enumerable:!1,configurable:!0}),t.prototype.resolveTarget=function(t){var e=this;if(void 0!==t)return t.map((function(t){if(!et(t))return t;var n=t[0]===e.delimiter;if(n&&!e.parent)return e.getStateNodeByPath(t.slice(1));var r=n?e.key+t:t;if(!e.parent)return e.getStateNodeByPath(r);try{return e.parent.getStateNodeByPath(r)}catch(t){throw new Error("Invalid transition definition for state node '".concat(e.id,"':\n").concat(t.message))}}))},t.prototype.formatTransition=function(t){var e=this,n=function(t){if(void 0!==t&&""!==t)return z(t)}(t.target),r="internal"in t?t.internal:!n||n.some((function(t){return et(t)&&t[0]===e.delimiter})),i=this.machine.options.guards,o=this.resolveTarget(n),s=f(f({},t),{actions:Ot(z(t.actions)),cond:nt(t.cond,i),target:o,source:this,internal:r,eventType:t.event,toJSON:function(){return f(f({},s),{target:s.target?s.target.map((function(t){return"#".concat(t.id)})):void 0,source:"#".concat(e.id)})}});return s},t.prototype.formatTransitions=function(){var t,e,n,r=this;if(this.config.on)if(Array.isArray(this.config.on))n=this.config.on;else{var i=this.config.on,o=i[qt],s=void 0===o?[]:o,a=d(i,["*"]);n=W(Object.keys(a).map((function(t){P||t!==Gt||Q(!1,"Empty string transition configs (e.g., `{ on: { '': ... }}`) for transient transitions are deprecated. Specify the transition in the `{ always: ... }` property instead. "+'Please check the `on` configuration for "#'.concat(r.id,'".'));var e=at(t,a[t]);return P||function(t,e,n){var r=n.slice(0,-1).some((function(t){return!("cond"in t)&&!("in"in t)&&(et(t.target)||it(t.target))})),i=e===Gt?"the transient event":"event '".concat(e,"'");Q(!r,"One or more transitions for ".concat(i," on state '").concat(t.id,"' are unreachable. ")+"Make sure that the default transition is the last one defined.")}(r,t,e),e})).concat(at(qt,s)))}else n=[];var c=this.config.always?at("",this.config.always):[],u=this.config.onDone?at(String(Lt(this.id)),this.config.onDone):[];P||Q(!(this.config.onDone&&!this.parent),'Root nodes cannot have an ".onDone" transition. Please check the config of "'.concat(this.id,'".'));var h=W(this.invoke.map((function(t){var e=[];return t.onDone&&e.push.apply(e,v([],y(at(String(It(t.id)),t.onDone)),!1)),t.onError&&e.push.apply(e,v([],y(at(String(jt(t.id)),t.onError)),!1)),e}))),l=this.after,f=W(v(v(v(v([],y(u),!1),y(h),!1),y(n),!1),y(c),!1).map((function(t){return z(t).map((function(t){return r.formatTransition(t)}))})));try{for(var g=p(l),m=g.next();!m.done;m=g.next()){var b=m.value;f.push(b)}}catch(e){t={error:e}}finally{try{m&&!m.done&&(e=g.return)&&e.call(g)}finally{if(t)throw t.error}}return f},t}(),zt=!1,Yt=function(t){return{type:_,assignment:t}},$t=At,Kt={deferEvents:!1},Xt=function(){function t(t){this.processingEvent=!1,this.queue=[],this.initialized=!1,this.options=f(f({},Kt),t)}return t.prototype.initialize=function(t){if(this.initialized=!0,t){if(!this.options.deferEvents)return void this.schedule(t);this.process(t)}this.flushEvents()},t.prototype.schedule=function(t){if(this.initialized&&!this.processingEvent){if(0!==this.queue.length)throw new Error("Event queue should be empty when it is not processing events");this.process(t),this.flushEvents()}else this.queue.push(t)},t.prototype.clear=function(){this.queue=[]},t.prototype.flushEvents=function(){for(var t=this.queue.shift();t;)this.process(t),t=this.queue.shift()},t.prototype.process=function(t){this.processingEvent=!0;try{t()}catch(t){throw this.clear(),t}finally{this.processingEvent=!1}},t}(),Qt=new Map,Zt=0,te=function(t){Qt.delete(t)};function ee(){return"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==t.g?t.g:void(P||console.warn("XState could not find a global object in this environment. Please let the maintainers know and raise an issue here: https://github.com/statelyai/xstate/issues"))}var ne,re={sync:!1,autoForward:!1};!function(t){t[t.NotStarted=0]="NotStarted",t[t.Running=1]="Running",t[t.Stopped=2]="Stopped"}(ne||(ne={}));var ie=function(){function t(e,i){void 0===i&&(i=t.defaultOptions);var o=this;this.machine=e,this.delayedEventsMap={},this.listeners=new Set,this.contextListeners=new Set,this.stopListeners=new Set,this.doneListeners=new Set,this.eventListeners=new Set,this.sendListeners=new Set,this.initialized=!1,this.status=ne.NotStarted,this.children=new Map,this.forwardTo=new Set,this._outgoingQueue=[],this.init=this.start,this.send=function(t,e){if(Z(t))return o.batch(t),o.state;var n=st(ot(t,e));if(o.status===ne.Stopped)return P||Q(!1,'Event "'.concat(n.name,'" was sent to stopped service "').concat(o.machine.id,'". This service has already reached its final state, and will not transition.\nEvent: ').concat(JSON.stringify(n.data))),o.state;if(o.status!==ne.Running&&!o.options.deferEvents)throw new Error('Event "'.concat(n.name,'" was sent to uninitialized service "').concat(o.machine.id,'". Make sure .start() is called for this service, or set { deferEvents: true } in the service options.\nEvent: ').concat(JSON.stringify(n.data)));return o.scheduler.schedule((function(){o.forward(n);var t=o._nextState(n);o.update(t,n)})),o._state},this.sendTo=function(t,e,n){var i=o.parent&&(e===r.Parent||o.parent.id===e),s=i?o.parent:et(e)?e===r.Internal?o:o.children.get(e)||function(t){return Qt.get(t)}(e):function(t){return!!t&&"function"==typeof t.send}(e)?e:void 0;if(s)if("machine"in s){if(o.status!==ne.Stopped||o.parent!==s||o.state.done){var a=f(f({},t),{name:t.name===A?"".concat(jt(o.id)):t.name,origin:o.sessionId});!n&&o.machine.config.predictableActionArguments?o._outgoingQueue.push([s,a]):s.send(a)}}else!n&&o.machine.config.predictableActionArguments?o._outgoingQueue.push([s,t.data]):s.send(t.data);else{if(!i)throw new Error("Unable to send event to child '".concat(e,"' from service '").concat(o.id,"'."));P||Q(!1,"Service '".concat(o.id,"' has no parent: unable to send event ").concat(t.type))}},this._exec=function(t,e,r,i){void 0===i&&(i=o.machine.options.actions);var s=t.exec||kt(t.type,i),a=tt(s)?s:s?s.exec:t.exec;if(a)try{return a(e,r.data,o.machine.config.predictableActionArguments?{action:t,_event:r}:{action:t,state:o.state,_event:r})}catch(t){throw o.parent&&o.parent.send({type:"xstate.error",data:t}),t}switch(t.type){case w:var c=t;o.defer(c);break;case S:var u=t;if("number"==typeof u.delay)return void o.defer(u);u.to?o.sendTo(u._event,u.to,r===_t):o.send(u._event);break;case E:o.cancel(t.sendId);break;case m:if(o.status!==ne.Running)return;var h=t.activity;if(!o.machine.config.predictableActionArguments&&!o.state.activities[h.id||h.type])break;if(h.type===n.Invoke){var l=ut(h.src),f=o.machine.options.services?o.machine.options.services[l.type]:void 0,d=h.id,p=h.data;P||Q(!("forward"in h),"`forward` property is deprecated (found in invocation of '".concat(h.src,"' in in machine '").concat(o.machine.id,"'). ")+"Please use `autoForward` instead.");var y="autoForward"in h?h.autoForward:!!h.forward;if(!f)return void(P||Q(!1,"No service found for invocation '".concat(h.src,"' in machine '").concat(o.machine.id,"'.")));var v=p?Y(p,e,r):void 0;if("string"==typeof f)return;var g=tt(f)?f(e,r.data,{data:v,src:l,meta:h.meta}):f;if(!g)return;var x=void 0;it(g)&&(g=v?g.withContext(v):g,x={autoForward:y}),o.spawn(g,d,x)}else o.spawnActivity(h);break;case b:o.stopChild(t.activity.id);break;case k:var _=t,T=_.label,O=_.value;T?o.logger(T,O):o.logger(O);break;default:P||Q(!1,"No implementation found for action type '".concat(t.type,"'"))}};var s=f(f({},t.defaultOptions),i),a=s.clock,c=s.logger,u=s.parent,h=s.id,l=void 0!==h?h:e.id;this.id=l,this.logger=c,this.clock=a,this.parent=u,this.options=s,this.scheduler=new Xt({deferEvents:this.options.deferEvents}),this.sessionId="x:".concat(Zt++)}return Object.defineProperty(t.prototype,"initialState",{get:function(){var t=this;return this._initialState?this._initialState:Dt(this,(function(){return t._initialState=t.machine.initialState,t._initialState}))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"state",{get:function(){return P||Q(this.status!==ne.NotStarted,"Attempted to read state from uninitialized service '".concat(this.id,"'. Make sure the service is started first.")),this._state},enumerable:!1,configurable:!0}),t.prototype.execute=function(t,e){var n,r;try{for(var i=p(t.actions),o=i.next();!o.done;o=i.next()){var s=o.value;this.exec(s,t,e)}}catch(t){n={error:t}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}},t.prototype.update=function(t,e){var n,r,i,o,s,a,c,u,h=this;if(t._sessionid=this.sessionId,this._state=t,this.machine.config.predictableActionArguments&&e!==_t||!this.options.execute)for(var l=void 0;l=this._outgoingQueue.shift();)l[0].send(l[1]);else this.execute(this.state);if(this.children.forEach((function(t){h.state.children[t.id]=t})),this.devTools&&this.devTools.send(e.data,t),t.event)try{for(var f=p(this.eventListeners),d=f.next();!d.done;d=f.next())(0,d.value)(t.event)}catch(t){n={error:t}}finally{try{d&&!d.done&&(r=f.return)&&r.call(f)}finally{if(n)throw n.error}}try{for(var y=p(this.listeners),v=y.next();!v.done;v=y.next())(0,v.value)(t,t.event)}catch(t){i={error:t}}finally{try{v&&!v.done&&(o=y.return)&&o.call(y)}finally{if(i)throw i.error}}try{for(var g=p(this.contextListeners),m=g.next();!m.done;m=g.next())(0,m.value)(this.state.context,this.state.history?this.state.history.context:void 0)}catch(t){s={error:t}}finally{try{m&&!m.done&&(a=g.return)&&a.call(g)}finally{if(s)throw s.error}}if(this.state.done){var b=t.configuration.find((function(t){return"final"===t.type&&t.parent===h.machine})),w=b&&b.doneData?Y(b.doneData,t.context,e):void 0;this._doneEvent=It(this.id,w);try{for(var S=p(this.doneListeners),E=S.next();!E.done;E=S.next())(0,E.value)(this._doneEvent)}catch(t){c={error:t}}finally{try{E&&!E.done&&(u=S.return)&&u.call(S)}finally{if(c)throw c.error}}this._stop(),this._stopChildren(),te(this.sessionId)}},t.prototype.onTransition=function(t){return this.listeners.add(t),this.status===ne.Running&&t(this.state,this.state.event),this},t.prototype.subscribe=function(t,e,n){var r=this,i=ht(t,e,n);this.listeners.add(i.next),this.status!==ne.NotStarted&&i.next(this.state);var o=function(){r.doneListeners.delete(o),r.stopListeners.delete(o),i.complete()};return this.status===ne.Stopped?i.complete():(this.onDone(o),this.onStop(o)),{unsubscribe:function(){r.listeners.delete(i.next),r.doneListeners.delete(o),r.stopListeners.delete(o)}}},t.prototype.onEvent=function(t){return this.eventListeners.add(t),this},t.prototype.onSend=function(t){return this.sendListeners.add(t),this},t.prototype.onChange=function(t){return this.contextListeners.add(t),this},t.prototype.onStop=function(t){return this.stopListeners.add(t),this},t.prototype.onDone=function(t){return this.status===ne.Stopped&&this._doneEvent?t(this._doneEvent):this.doneListeners.add(t),this},t.prototype.off=function(t){return this.listeners.delete(t),this.eventListeners.delete(t),this.sendListeners.delete(t),this.stopListeners.delete(t),this.doneListeners.delete(t),this.contextListeners.delete(t),this},t.prototype.start=function(t){var e,n,r=this;if(this.status===ne.Running)return this;this.machine._init(),e=this.sessionId,n=this,Qt.set(e,n),this.initialized=!0,this.status=ne.Running;var i=void 0===t?this.initialState:Dt(this,(function(){return"object"==typeof(e=t)&&null!==e&&"value"in e&&"_event"in e?r.machine.resolveState(t):r.machine.resolveState(Mt.from(t,r.machine.context));var e}));return this.options.devTools&&this.attachDev(),this.scheduler.initialize((function(){r.update(i,_t)})),this},t.prototype._stopChildren=function(){this.children.forEach((function(t){tt(t.stop)&&t.stop()})),this.children.clear()},t.prototype._stop=function(){var t,e,n,r,i,o,s,a,c,u;try{for(var h=p(this.listeners),l=h.next();!l.done;l=h.next()){var f=l.value;this.listeners.delete(f)}}catch(e){t={error:e}}finally{try{l&&!l.done&&(e=h.return)&&e.call(h)}finally{if(t)throw t.error}}try{for(var d=p(this.stopListeners),y=d.next();!y.done;y=d.next())(f=y.value)(),this.stopListeners.delete(f)}catch(t){n={error:t}}finally{try{y&&!y.done&&(r=d.return)&&r.call(d)}finally{if(n)throw n.error}}try{for(var v=p(this.contextListeners),g=v.next();!g.done;g=v.next())f=g.value,this.contextListeners.delete(f)}catch(t){i={error:t}}finally{try{g&&!g.done&&(o=v.return)&&o.call(v)}finally{if(i)throw i.error}}try{for(var m=p(this.doneListeners),b=m.next();!b.done;b=m.next())f=b.value,this.doneListeners.delete(f)}catch(t){s={error:t}}finally{try{b&&!b.done&&(a=m.return)&&a.call(m)}finally{if(s)throw s.error}}if(!this.initialized)return this;this.initialized=!1,this.status=ne.Stopped,this._initialState=void 0;try{for(var w=p(Object.keys(this.delayedEventsMap)),S=w.next();!S.done;S=w.next()){var E=S.value;this.clock.clearTimeout(this.delayedEventsMap[E])}}catch(t){c={error:t}}finally{try{S&&!S.done&&(u=w.return)&&u.call(w)}finally{if(c)throw c.error}}this.scheduler.clear(),this.scheduler=new Xt({deferEvents:this.options.deferEvents})},t.prototype.stop=function(){var t=this,e=this.scheduler;return this._stop(),e.schedule((function(){var e;if(!(null===(e=t._state)||void 0===e?void 0:e.done)){var n=st({type:"xstate.stop"}),r=Dt(t,(function(){var e=W(v([],y(t.state.configuration),!1).sort((function(t,e){return e.order-t.order})).map((function(e){return Ot(e.onExit,t.machine.options.actions)}))),r=y(Ct(t.machine,t.state,t.state.context,n,[{type:"exit",actions:e}],t.machine.config.predictableActionArguments?t._exec:void 0,t.machine.config.predictableActionArguments||t.machine.config.preserveActionOrder),2),i=r[0],o=r[1],s=new Mt({value:t.state.value,context:o,_event:n,_sessionid:t.sessionId,historyValue:void 0,history:t.state,actions:i.filter((function(t){return!ft(t)})),activities:{},events:[],configuration:[],transitions:[],children:{},done:t.state.done,tags:t.state.tags,machine:t.machine});return s.changed=!0,s}));t.update(r,n),t._stopChildren(),te(t.sessionId)}})),this},t.prototype.batch=function(t){var e=this;if(this.status===ne.NotStarted&&this.options.deferEvents)P||Q(!1,"".concat(t.length,' event(s) were sent to uninitialized service "').concat(this.machine.id,'" and are deferred. Make sure .start() is called for this service.\nEvent: ').concat(JSON.stringify(event)));else if(this.status!==ne.Running)throw new Error("".concat(t.length,' event(s) were sent to uninitialized service "').concat(this.machine.id,'". Make sure .start() is called for this service, or set { deferEvents: true } in the service options.'));if(t.length){var n=!!this.machine.config.predictableActionArguments&&this._exec;this.scheduler.schedule((function(){var r,i,o=e.state,s=!1,a=[],c=function(t){var r=st(t);e.forward(r),o=Dt(e,(function(){return e.machine.transition(o,r,void 0,n||void 0)})),a.push.apply(a,v([],y(e.machine.config.predictableActionArguments?o.actions:o.actions.map((function(t){return function(t,e){var n=t.exec;return f(f({},t),{exec:void 0!==n?function(){return n(e.context,e.event,{action:t,state:e,_event:e._event})}:void 0})}(t,o)}))),!1)),s=s||!!o.changed};try{for(var u=p(t),h=u.next();!h.done;h=u.next())c(h.value)}catch(t){r={error:t}}finally{try{h&&!h.done&&(i=u.return)&&i.call(u)}finally{if(r)throw r.error}}o.changed=s,o.actions=a,e.update(o,st(t[t.length-1]))}))}},t.prototype.sender=function(t){return this.send.bind(this,t)},t.prototype._nextState=function(t,e){var n=this;void 0===e&&(e=!!this.machine.config.predictableActionArguments&&this._exec);var r=st(t);if(0===r.name.indexOf(N)&&!this.state.nextEvents.some((function(t){return 0===t.indexOf(N)})))throw r.data.data;return Dt(this,(function(){return n.machine.transition(n.state,r,void 0,e||void 0)}))},t.prototype.nextState=function(t){return this._nextState(t,!1)},t.prototype.forward=function(t){var e,n;try{for(var r=p(this.forwardTo),i=r.next();!i.done;i=r.next()){var o=i.value,s=this.children.get(o);if(!s)throw new Error("Unable to forward event '".concat(t,"' from interpreter '").concat(this.id,"' to nonexistant child '").concat(o,"'."));s.send(t)}}catch(t){e={error:t}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}},t.prototype.defer=function(t){var e=this,n=this.clock.setTimeout((function(){"to"in t&&t.to?e.sendTo(t._event,t.to,!0):e.send(t._event)}),t.delay);t.id&&(this.delayedEventsMap[t.id]=n)},t.prototype.cancel=function(t){this.clock.clearTimeout(this.delayedEventsMap[t]),delete this.delayedEventsMap[t]},t.prototype.exec=function(t,e,n){void 0===n&&(n=this.machine.options.actions),this._exec(t,e.context,e._event,n)},t.prototype.removeChild=function(t){var e;this.children.delete(t),this.forwardTo.delete(t),null===(e=this.state)||void 0===e||delete e.children[t]},t.prototype.stopChild=function(t){var e=this.children.get(t);e&&(this.removeChild(t),tt(e.stop)&&e.stop())},t.prototype.spawn=function(t,e,n){if(this.status!==ne.Running)return Ft(t,e);if($(t))return this.spawnPromise(Promise.resolve(t),e);if(tt(t))return this.spawnCallback(t,e);if(function(t){try{return"function"==typeof t.send}catch(t){return!1}}(r=t)&&"id"in r)return this.spawnActor(t,e);if(function(t){try{return"subscribe"in t&&tt(t.subscribe)}catch(t){return!1}}(t))return this.spawnObservable(t,e);if(it(t))return this.spawnMachine(t,f(f({},n),{id:e}));if(function(t){return null!==t&&"object"==typeof t&&"transition"in t&&"function"==typeof t.transition}(t))return this.spawnBehavior(t,e);throw new Error('Unable to spawn entity "'.concat(e,'" of type "').concat(typeof t,'".'));var r},t.prototype.spawnMachine=function(e,n){var r=this;void 0===n&&(n={});var i=new t(e,f(f({},this.options),{parent:this,id:n.id||e.id})),o=f(f({},re),n);o.sync&&i.onTransition((function(t){r.send(R,{state:t,id:i.id})}));var s=i;return this.children.set(i.id,s),o.autoForward&&this.forwardTo.add(i.id),i.onDone((function(t){r.removeChild(i.id),r.send(st(t,{origin:i.id}))})).start(),s},t.prototype.spawnBehavior=function(t,e){var n=function(t,e){void 0===e&&(e={});var n=t.initialState,r=new Set,i=[],o=!1,s=function(t){var e;return f(((e={subscribe:function(){return{unsubscribe:function(){}}},id:"anonymous",getSnapshot:function(){}})[rt]=function(){return this},e),t)}({id:e.id,send:function(e){i.push(e),function(){if(!o){for(o=!0;i.length>0;){var e=i.shift();n=t.transition(n,e,a),r.forEach((function(t){return t.next(n)}))}o=!1}}()},getSnapshot:function(){return n},subscribe:function(t,e,i){var o=ht(t,e,i);return r.add(o),o.next(n),{unsubscribe:function(){r.delete(o)}}}}),a={parent:e.parent,self:s,id:e.id||"anonymous",observers:r};return n=t.start?t.start(a):n,s}(t,{id:e,parent:this});return this.children.set(e,n),n},t.prototype.spawnPromise=function(t,e){var n,r,i=this,o=!1;t.then((function(t){o||(r=t,i.removeChild(e),i.send(st(It(e,t),{origin:e})))}),(function(t){if(!o){i.removeChild(e);var n=jt(e,t);try{i.send(st(n,{origin:e}))}catch(r){!function(t,e,n){if(!P){var r=t.stack?" Stacktrace was '".concat(t.stack,"'"):"";if(t===e)console.error("Missing onError handler for invocation '".concat(n,"', error was '").concat(t,"'.").concat(r));else{var i=e.stack?" Stacktrace was '".concat(e.stack,"'"):"";console.error("Missing onError handler and/or unhandled exception/promise rejection for invocation '".concat(n,"'. ")+"Original error: '".concat(t,"'. ").concat(r," Current error is '").concat(e,"'.").concat(i))}}}(t,r,e),i.devTools&&i.devTools.send(n,i.state),i.machine.strict&&i.stop()}}}));var s=((n={id:e,send:function(){},subscribe:function(e,n,r){var i=ht(e,n,r),o=!1;return t.then((function(t){o||(i.next(t),o||i.complete())}),(function(t){o||i.error(t)})),{unsubscribe:function(){return o=!0}}},stop:function(){o=!0},toJSON:function(){return{id:e}},getSnapshot:function(){return r}})[rt]=function(){return this},n);return this.children.set(e,s),s},t.prototype.spawnCallback=function(t,e){var n,r,i,o=this,s=!1,a=new Set,c=new Set;try{i=t((function(t){r=t,c.forEach((function(e){return e(t)})),s||o.send(st(t,{origin:e}))}),(function(t){a.add(t)}))}catch(t){this.send(jt(e,t))}if($(i))return this.spawnPromise(i,e);var u=((n={id:e,send:function(t){return a.forEach((function(e){return e(t)}))},subscribe:function(t){var e=ht(t);return c.add(e.next),{unsubscribe:function(){c.delete(e.next)}}},stop:function(){s=!0,tt(i)&&i()},toJSON:function(){return{id:e}},getSnapshot:function(){return r}})[rt]=function(){return this},n);return this.children.set(e,u),u},t.prototype.spawnObservable=function(t,e){var n,r,i=this,o=t.subscribe((function(t){r=t,i.send(st(t,{origin:e}))}),(function(t){i.removeChild(e),i.send(st(jt(e,t),{origin:e}))}),(function(){i.removeChild(e),i.send(st(It(e),{origin:e}))})),s=((n={id:e,send:function(){},subscribe:function(e,n,r){return t.subscribe(e,n,r)},stop:function(){return o.unsubscribe()},getSnapshot:function(){return r},toJSON:function(){return{id:e}}})[rt]=function(){return this},n);return this.children.set(e,s),s},t.prototype.spawnActor=function(t,e){return this.children.set(e,t),t},t.prototype.spawnActivity=function(t){var e=this.machine.options&&this.machine.options.activities?this.machine.options.activities[t.type]:void 0;if(e){var n=e(this.state.context,t);this.spawnEffect(t.id,n)}else P||Q(!1,"No implementation found for activity '".concat(t.type,"'"))},t.prototype.spawnEffect=function(t,e){var n;this.children.set(t,((n={id:t,send:function(){},subscribe:function(){return{unsubscribe:function(){}}},stop:e||void 0,getSnapshot:function(){},toJSON:function(){return{id:t}}})[rt]=function(){return this},n))},t.prototype.attachDev=function(){var t=ee();if(this.options.devTools&&t){if(t.__REDUX_DEVTOOLS_EXTENSION__){var e="object"==typeof this.options.devTools?this.options.devTools:void 0;this.devTools=t.__REDUX_DEVTOOLS_EXTENSION__.connect(f(f({name:this.id,autoPause:!0,stateSanitizer:function(t){return{value:t.value,context:t.context,actions:t.actions}}},e),{features:f({jump:!1,skip:!1},e?e.features:void 0)}),this.machine),this.devTools.init(this.state)}!function(t){if(ee()){var e=function(){var t=ee();if(t&&"__xstate__"in t)return t.__xstate__}();e&&e.register(t)}}(this)}},t.prototype.toJSON=function(){return{id:this.id}},t.prototype[rt]=function(){return this},t.prototype.getSnapshot=function(){return this.status===ne.NotStarted?this.initialState:this._state},t.defaultOptions={execute:!0,deferEvents:!0,clock:{setTimeout:function(t,e){return setTimeout(t,e)},clearTimeout:function(t){return clearTimeout(t)}},logger:console.log.bind(console),devTools:!1},t.interpret=oe,t}();function oe(t,e){return new ie(t,e)}var se=function(t){return t.START="start",t.STOP="stop",t.ERROR="error",t.STARTED="started",t}({}),ae=function(t){return t.SIGN_IN_GOOGLE="sign-in-google",t.SIGNED_IN="signed-in",t.IS_SIGNED_IN="is-signed-in",t.AUTO_SIGN_IN="auto-sign-in",t.SIGN_OUT="sign-out",t.AUTH_ERROR="auth-error",t.SAVE_SETTINGS="save-settings",t}({}),ce=function(t){return t.SHOW_UI="show-ui",t.HIDE_UI="hide-ui",t.GET_UI_STATE="get-ui-state",t}({});const ue=Object.create(null);ue.open="0",ue.close="1",ue.ping="2",ue.pong="3",ue.message="4",ue.upgrade="5",ue.noop="6";const he=Object.create(null);Object.keys(ue).forEach((t=>{he[ue[t]]=t}));const le={type:"error",data:"parser error"},fe="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),de="function"==typeof ArrayBuffer,pe=t=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer instanceof ArrayBuffer,ye=({type:t,data:e},n,r)=>fe&&e instanceof Blob?n?r(e):ve(e,r):de&&(e instanceof ArrayBuffer||pe(e))?n?r(e):ve(new Blob([e]),r):r(ue[t]+(e||"")),ve=(t,e)=>{const n=new FileReader;return n.onload=function(){const t=n.result.split(",")[1];e("b"+(t||""))},n.readAsDataURL(t)};function ge(t){return t instanceof Uint8Array?t:t instanceof ArrayBuffer?new Uint8Array(t):new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}let me;const be="undefined"==typeof Uint8Array?[]:new Uint8Array(256);for(let t=0;t<64;t++)be["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charCodeAt(t)]=t;const we="function"==typeof ArrayBuffer,Se=(t,e)=>{if("string"!=typeof t)return{type:"message",data:xe(t,e)};const n=t.charAt(0);return"b"===n?{type:"message",data:Ee(t.substring(1),e)}:he[n]?t.length>1?{type:he[n],data:t.substring(1)}:{type:he[n]}:le},Ee=(t,e)=>{if(we){const n=(t=>{let e,n,r,i,o,s=.75*t.length,a=t.length,c=0;"="===t[t.length-1]&&(s--,"="===t[t.length-2]&&s--);const u=new ArrayBuffer(s),h=new Uint8Array(u);for(e=0;e<a;e+=4)n=be[t.charCodeAt(e)],r=be[t.charCodeAt(e+1)],i=be[t.charCodeAt(e+2)],o=be[t.charCodeAt(e+3)],h[c++]=n<<2|r>>4,h[c++]=(15&r)<<4|i>>2,h[c++]=(3&i)<<6|63&o;return u})(t);return xe(n,e)}return{base64:!0,data:t}},xe=(t,e)=>"blob"===e?t instanceof Blob?t:new Blob([t]):t instanceof ArrayBuffer?t:t.buffer,_e=String.fromCharCode(30);let ke;function Te(t){return t.reduce(((t,e)=>t+e.length),0)}function Oe(t,e){if(t[0].length===e)return t.shift();const n=new Uint8Array(e);let r=0;for(let i=0;i<e;i++)n[i]=t[0][r++],r===t[0].length&&(t.shift(),r=0);return t.length&&r<t[0].length&&(t[0]=t[0].slice(r)),n}function Ne(t){if(t)return function(t){for(var e in Ne.prototype)t[e]=Ne.prototype[e];return t}(t)}Ne.prototype.on=Ne.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this},Ne.prototype.once=function(t,e){function n(){this.off(t,n),e.apply(this,arguments)}return n.fn=e,this.on(t,n),this},Ne.prototype.off=Ne.prototype.removeListener=Ne.prototype.removeAllListeners=Ne.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,r=this._callbacks["$"+t];if(!r)return this;if(1==arguments.length)return delete this._callbacks["$"+t],this;for(var i=0;i<r.length;i++)if((n=r[i])===e||n.fn===e){r.splice(i,1);break}return 0===r.length&&delete this._callbacks["$"+t],this},Ne.prototype.emit=function(t){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),n=this._callbacks["$"+t],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(n){r=0;for(var i=(n=n.slice(0)).length;r<i;++r)n[r].apply(this,e)}return this},Ne.prototype.emitReserved=Ne.prototype.emit,Ne.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]},Ne.prototype.hasListeners=function(t){return!!this.listeners(t).length};const Ae="undefined"!=typeof self?self:"undefined"!=typeof window?window:Function("return this")();function Re(t,...e){return e.reduce(((e,n)=>(t.hasOwnProperty(n)&&(e[n]=t[n]),e)),{})}const Le=Ae.setTimeout,Ie=Ae.clearTimeout;function je(t,e){e.useNativeTimers?(t.setTimeoutFn=Le.bind(Ae),t.clearTimeoutFn=Ie.bind(Ae)):(t.setTimeoutFn=Ae.setTimeout.bind(Ae),t.clearTimeoutFn=Ae.clearTimeout.bind(Ae))}class Ce extends Error{constructor(t,e,n){super(t),this.description=e,this.context=n,this.type="TransportError"}}class Pe extends Ne{constructor(t){super(),this.writable=!1,je(this,t),this.opts=t,this.query=t.query,this.socket=t.socket}onError(t,e,n){return super.emitReserved("error",new Ce(t,e,n)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}send(t){"open"===this.readyState&&this.write(t)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(t){const e=Se(t,this.socket.binaryType);this.onPacket(e)}onPacket(t){super.emitReserved("packet",t)}onClose(t){this.readyState="closed",super.emitReserved("close",t)}pause(t){}createUri(t,e={}){return t+"://"+this._hostname()+this._port()+this.opts.path+this._query(e)}_hostname(){const t=this.opts.hostname;return-1===t.indexOf(":")?t:"["+t+"]"}_port(){return this.opts.port&&(this.opts.secure&&Number(443!==this.opts.port)||!this.opts.secure&&80!==Number(this.opts.port))?":"+this.opts.port:""}_query(t){const e=function(t){let e="";for(let n in t)t.hasOwnProperty(n)&&(e.length&&(e+="&"),e+=encodeURIComponent(n)+"="+encodeURIComponent(t[n]));return e}(t);return e.length?"?"+e:""}}const Me="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),Be=64,De={};let Ue,Fe=0,Ve=0;function Ge(t){let e="";do{e=Me[t%Be]+e,t=Math.floor(t/Be)}while(t>0);return e}function qe(){const t=Ge(+new Date);return t!==Ue?(Fe=0,Ue=t):t+"."+Ge(Fe++)}for(;Ve<Be;Ve++)De[Me[Ve]]=Ve;let He=!1;try{He="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(t){}const We=He;function Je(t){const e=t.xdomain;try{if("undefined"!=typeof XMLHttpRequest&&(!e||We))return new XMLHttpRequest}catch(t){}if(!e)try{return new(Ae[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(t){}}function ze(){}const Ye=null!=new Je({xdomain:!1}).responseType;class $e extends Ne{constructor(t,e){super(),je(this,e),this.opts=e,this.method=e.method||"GET",this.uri=t,this.data=void 0!==e.data?e.data:null,this.create()}create(){var t;const e=Re(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");e.xdomain=!!this.opts.xd;const n=this.xhr=new Je(e);try{n.open(this.method,this.uri,!0);try{if(this.opts.extraHeaders){n.setDisableHeaderCheck&&n.setDisableHeaderCheck(!0);for(let t in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(t)&&n.setRequestHeader(t,this.opts.extraHeaders[t])}}catch(t){}if("POST"===this.method)try{n.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(t){}try{n.setRequestHeader("Accept","*/*")}catch(t){}null===(t=this.opts.cookieJar)||void 0===t||t.addCookies(n),"withCredentials"in n&&(n.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(n.timeout=this.opts.requestTimeout),n.onreadystatechange=()=>{var t;3===n.readyState&&(null===(t=this.opts.cookieJar)||void 0===t||t.parseCookies(n)),4===n.readyState&&(200===n.status||1223===n.status?this.onLoad():this.setTimeoutFn((()=>{this.onError("number"==typeof n.status?n.status:0)}),0))},n.send(this.data)}catch(t){return void this.setTimeoutFn((()=>{this.onError(t)}),0)}"undefined"!=typeof document&&(this.index=$e.requestsCount++,$e.requests[this.index]=this)}onError(t){this.emitReserved("error",t,this.xhr),this.cleanup(!0)}cleanup(t){if(void 0!==this.xhr&&null!==this.xhr){if(this.xhr.onreadystatechange=ze,t)try{this.xhr.abort()}catch(t){}"undefined"!=typeof document&&delete $e.requests[this.index],this.xhr=null}}onLoad(){const t=this.xhr.responseText;null!==t&&(this.emitReserved("data",t),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}function Ke(){for(let t in $e.requests)$e.requests.hasOwnProperty(t)&&$e.requests[t].abort()}$e.requestsCount=0,$e.requests={},"undefined"!=typeof document&&("function"==typeof attachEvent?attachEvent("onunload",Ke):"function"==typeof addEventListener&&addEventListener("onpagehide"in Ae?"pagehide":"unload",Ke,!1));const Xe="function"==typeof Promise&&"function"==typeof Promise.resolve?t=>Promise.resolve().then(t):(t,e)=>e(t,0),Qe=Ae.WebSocket||Ae.MozWebSocket,Ze="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase(),tn={websocket:class extends Pe{constructor(t){super(t),this.supportsBinary=!t.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const t=this.uri(),e=this.opts.protocols,n=Ze?{}:Re(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=Ze?new Qe(t,e,n):e?new Qe(t,e):new Qe(t)}catch(t){return this.emitReserved("error",t)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=t=>this.onClose({description:"websocket connection closed",context:t}),this.ws.onmessage=t=>this.onData(t.data),this.ws.onerror=t=>this.onError("websocket error",t)}write(t){this.writable=!1;for(let e=0;e<t.length;e++){const n=t[e],r=e===t.length-1;ye(n,this.supportsBinary,(t=>{try{this.ws.send(t)}catch(t){}r&&Xe((()=>{this.writable=!0,this.emitReserved("drain")}),this.setTimeoutFn)}))}}doClose(){void 0!==this.ws&&(this.ws.close(),this.ws=null)}uri(){const t=this.opts.secure?"wss":"ws",e=this.query||{};return this.opts.timestampRequests&&(e[this.opts.timestampParam]=qe()),this.supportsBinary||(e.b64=1),this.createUri(t,e)}check(){return!!Qe}},webtransport:class extends Pe{get name(){return"webtransport"}doOpen(){"function"==typeof WebTransport&&(this.transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name]),this.transport.closed.then((()=>{this.onClose()})).catch((t=>{this.onError("webtransport error",t)})),this.transport.ready.then((()=>{this.transport.createBidirectionalStream().then((t=>{const e=function(t,e){ke||(ke=new TextDecoder);const n=[];let r=0,i=-1,o=!1;return new TransformStream({transform(s,a){for(n.push(s);;){if(0===r){if(Te(n)<1)break;const t=Oe(n,1);o=128==(128&t[0]),i=127&t[0],r=i<126?3:126===i?1:2}else if(1===r){if(Te(n)<2)break;const t=Oe(n,2);i=new DataView(t.buffer,t.byteOffset,t.length).getUint16(0),r=3}else if(2===r){if(Te(n)<8)break;const t=Oe(n,8),e=new DataView(t.buffer,t.byteOffset,t.length),o=e.getUint32(0);if(o>Math.pow(2,21)-1){a.enqueue(le);break}i=o*Math.pow(2,32)+e.getUint32(4),r=3}else{if(Te(n)<i)break;const t=Oe(n,i);a.enqueue(Se(o?t:ke.decode(t),e)),r=0}if(0===i||i>t){a.enqueue(le);break}}}})}(Number.MAX_SAFE_INTEGER,this.socket.binaryType),n=t.readable.pipeThrough(e).getReader(),r=new TransformStream({transform(t,e){!function(t,e){fe&&t.data instanceof Blob?t.data.arrayBuffer().then(ge).then(e):de&&(t.data instanceof ArrayBuffer||pe(t.data))?e(ge(t.data)):ye(t,!1,(t=>{me||(me=new TextEncoder),e(me.encode(t))}))}(t,(n=>{const r=n.length;let i;if(r<126)i=new Uint8Array(1),new DataView(i.buffer).setUint8(0,r);else if(r<65536){i=new Uint8Array(3);const t=new DataView(i.buffer);t.setUint8(0,126),t.setUint16(1,r)}else{i=new Uint8Array(9);const t=new DataView(i.buffer);t.setUint8(0,127),t.setBigUint64(1,BigInt(r))}t.data&&"string"!=typeof t.data&&(i[0]|=128),e.enqueue(i),e.enqueue(n)}))}});r.readable.pipeTo(t.writable),this.writer=r.writable.getWriter();const i=()=>{n.read().then((({done:t,value:e})=>{t||(this.onPacket(e),i())})).catch((t=>{}))};i();const o={type:"open"};this.query.sid&&(o.data=`{"sid":"${this.query.sid}"}`),this.writer.write(o).then((()=>this.onOpen()))}))})))}write(t){this.writable=!1;for(let e=0;e<t.length;e++){const n=t[e],r=e===t.length-1;this.writer.write(n).then((()=>{r&&Xe((()=>{this.writable=!0,this.emitReserved("drain")}),this.setTimeoutFn)}))}}doClose(){var t;null===(t=this.transport)||void 0===t||t.close()}},polling:class extends Pe{constructor(t){if(super(t),this.polling=!1,"undefined"!=typeof location){const e="https:"===location.protocol;let n=location.port;n||(n=e?"443":"80"),this.xd="undefined"!=typeof location&&t.hostname!==location.hostname||n!==t.port}const e=t&&t.forceBase64;this.supportsBinary=Ye&&!e,this.opts.withCredentials&&(this.cookieJar=void 0)}get name(){return"polling"}doOpen(){this.poll()}pause(t){this.readyState="pausing";const e=()=>{this.readyState="paused",t()};if(this.polling||!this.writable){let t=0;this.polling&&(t++,this.once("pollComplete",(function(){--t||e()}))),this.writable||(t++,this.once("drain",(function(){--t||e()})))}else e()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(t){((t,e)=>{const n=t.split(_e),r=[];for(let t=0;t<n.length;t++){const i=Se(n[t],e);if(r.push(i),"error"===i.type)break}return r})(t,this.socket.binaryType).forEach((t=>{if("opening"===this.readyState&&"open"===t.type&&this.onOpen(),"close"===t.type)return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(t)})),"closed"!==this.readyState&&(this.polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState&&this.poll())}doClose(){const t=()=>{this.write([{type:"close"}])};"open"===this.readyState?t():this.once("open",t)}write(t){this.writable=!1,((t,e)=>{const n=t.length,r=new Array(n);let i=0;t.forEach(((t,o)=>{ye(t,!1,(t=>{r[o]=t,++i===n&&e(r.join(_e))}))}))})(t,(t=>{this.doWrite(t,(()=>{this.writable=!0,this.emitReserved("drain")}))}))}uri(){const t=this.opts.secure?"https":"http",e=this.query||{};return!1!==this.opts.timestampRequests&&(e[this.opts.timestampParam]=qe()),this.supportsBinary||e.sid||(e.b64=1),this.createUri(t,e)}request(t={}){return Object.assign(t,{xd:this.xd,cookieJar:this.cookieJar},this.opts),new $e(this.uri(),t)}doWrite(t,e){const n=this.request({method:"POST",data:t});n.on("success",e),n.on("error",((t,e)=>{this.onError("xhr post error",t,e)}))}doPoll(){const t=this.request();t.on("data",this.onData.bind(this)),t.on("error",((t,e)=>{this.onError("xhr poll error",t,e)})),this.pollXhr=t}}},en=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,nn=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function rn(t){if(t.length>2e3)throw"URI too long";const e=t,n=t.indexOf("["),r=t.indexOf("]");-1!=n&&-1!=r&&(t=t.substring(0,n)+t.substring(n,r).replace(/:/g,";")+t.substring(r,t.length));let i=en.exec(t||""),o={},s=14;for(;s--;)o[nn[s]]=i[s]||"";return-1!=n&&-1!=r&&(o.source=e,o.host=o.host.substring(1,o.host.length-1).replace(/;/g,":"),o.authority=o.authority.replace("[","").replace("]","").replace(/;/g,":"),o.ipv6uri=!0),o.pathNames=function(t,e){const n=e.replace(/\/{2,9}/g,"/").split("/");return"/"!=e.slice(0,1)&&0!==e.length||n.splice(0,1),"/"==e.slice(-1)&&n.splice(n.length-1,1),n}(0,o.path),o.queryKey=function(t,e){const n={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,(function(t,e,r){e&&(n[e]=r)})),n}(0,o.query),o}class on extends Ne{constructor(t,e={}){super(),this.binaryType="arraybuffer",this.writeBuffer=[],t&&"object"==typeof t&&(e=t,t=null),t?(t=rn(t),e.hostname=t.host,e.secure="https"===t.protocol||"wss"===t.protocol,e.port=t.port,t.query&&(e.query=t.query)):e.host&&(e.hostname=rn(e.host).host),je(this,e),this.secure=null!=e.secure?e.secure:"undefined"!=typeof location&&"https:"===location.protocol,e.hostname&&!e.port&&(e.port=this.secure?"443":"80"),this.hostname=e.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=e.port||("undefined"!=typeof location&&location.port?location.port:this.secure?"443":"80"),this.transports=e.transports||["polling","websocket","webtransport"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},e),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),"string"==typeof this.opts.query&&(this.opts.query=function(t){let e={},n=t.split("&");for(let t=0,r=n.length;t<r;t++){let r=n[t].split("=");e[decodeURIComponent(r[0])]=decodeURIComponent(r[1])}return e}(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,"function"==typeof addEventListener&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),"localhost"!==this.hostname&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(t){const e=Object.assign({},this.opts.query);e.EIO=4,e.transport=t,this.id&&(e.sid=this.id);const n=Object.assign({},this.opts,{query:e,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[t]);return new tn[t](n)}open(){let t;if(this.opts.rememberUpgrade&&on.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))t="websocket";else{if(0===this.transports.length)return void this.setTimeoutFn((()=>{this.emitReserved("error","No transports available")}),0);t=this.transports[0]}this.readyState="opening";try{t=this.createTransport(t)}catch(t){return this.transports.shift(),void this.open()}t.open(),this.setTransport(t)}setTransport(t){this.transport&&this.transport.removeAllListeners(),this.transport=t,t.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",(t=>this.onClose("transport close",t)))}probe(t){let e=this.createTransport(t),n=!1;on.priorWebsocketSuccess=!1;const r=()=>{n||(e.send([{type:"ping",data:"probe"}]),e.once("packet",(t=>{if(!n)if("pong"===t.type&&"probe"===t.data){if(this.upgrading=!0,this.emitReserved("upgrading",e),!e)return;on.priorWebsocketSuccess="websocket"===e.name,this.transport.pause((()=>{n||"closed"!==this.readyState&&(u(),this.setTransport(e),e.send([{type:"upgrade"}]),this.emitReserved("upgrade",e),e=null,this.upgrading=!1,this.flush())}))}else{const t=new Error("probe error");t.transport=e.name,this.emitReserved("upgradeError",t)}})))};function i(){n||(n=!0,u(),e.close(),e=null)}const o=t=>{const n=new Error("probe error: "+t);n.transport=e.name,i(),this.emitReserved("upgradeError",n)};function s(){o("transport closed")}function a(){o("socket closed")}function c(t){e&&t.name!==e.name&&i()}const u=()=>{e.removeListener("open",r),e.removeListener("error",o),e.removeListener("close",s),this.off("close",a),this.off("upgrading",c)};e.once("open",r),e.once("error",o),e.once("close",s),this.once("close",a),this.once("upgrading",c),-1!==this.upgrades.indexOf("webtransport")&&"webtransport"!==t?this.setTimeoutFn((()=>{n||e.open()}),200):e.open()}onOpen(){if(this.readyState="open",on.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade){let t=0;const e=this.upgrades.length;for(;t<e;t++)this.probe(this.upgrades[t])}}onPacket(t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",t),this.emitReserved("heartbeat"),this.resetPingTimeout(),t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"ping":this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const e=new Error("server error");e.code=t.data,this.onError(e);break;case"message":this.emitReserved("data",t.data),this.emitReserved("message",t.data)}}onHandshake(t){this.emitReserved("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this.upgrades=this.filterUpgrades(t.upgrades),this.pingInterval=t.pingInterval,this.pingTimeout=t.pingTimeout,this.maxPayload=t.maxPayload,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn((()=>{this.onClose("ping timeout")}),this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const t=this.getWritablePackets();this.transport.send(t),this.prevBufferLen=t.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1))return this.writeBuffer;let t=1;for(let n=0;n<this.writeBuffer.length;n++){const r=this.writeBuffer[n].data;if(r&&(t+="string"==typeof(e=r)?function(t){let e=0,n=0;for(let r=0,i=t.length;r<i;r++)e=t.charCodeAt(r),e<128?n+=1:e<2048?n+=2:e<55296||e>=57344?n+=3:(r++,n+=4);return n}(e):Math.ceil(1.33*(e.byteLength||e.size))),n>0&&t>this.maxPayload)return this.writeBuffer.slice(0,n);t+=2}var e;return this.writeBuffer}write(t,e,n){return this.sendPacket("message",t,e,n),this}send(t,e,n){return this.sendPacket("message",t,e,n),this}sendPacket(t,e,n,r){if("function"==typeof e&&(r=e,e=void 0),"function"==typeof n&&(r=n,n=null),"closing"===this.readyState||"closed"===this.readyState)return;(n=n||{}).compress=!1!==n.compress;const i={type:t,data:e,options:n};this.emitReserved("packetCreate",i),this.writeBuffer.push(i),r&&this.once("flush",r),this.flush()}close(){const t=()=>{this.onClose("forced close"),this.transport.close()},e=()=>{this.off("upgrade",e),this.off("upgradeError",e),t()},n=()=>{this.once("upgrade",e),this.once("upgradeError",e)};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",(()=>{this.upgrading?n():t()})):this.upgrading?n():t()),this}onError(t){on.priorWebsocketSuccess=!1,this.emitReserved("error",t),this.onClose("transport error",t)}onClose(t,e){"opening"!==this.readyState&&"open"!==this.readyState&&"closing"!==this.readyState||(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"==typeof removeEventListener&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",t,e),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(t){const e=[];let n=0;const r=t.length;for(;n<r;n++)~this.transports.indexOf(t[n])&&e.push(t[n]);return e}}on.protocol=4,on.protocol;const sn="function"==typeof ArrayBuffer,an=t=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(t):t.buffer instanceof ArrayBuffer,cn=Object.prototype.toString,un="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===cn.call(Blob),hn="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===cn.call(File);function ln(t){return sn&&(t instanceof ArrayBuffer||an(t))||un&&t instanceof Blob||hn&&t instanceof File}function fn(t,e){if(!t||"object"!=typeof t)return!1;if(Array.isArray(t)){for(let e=0,n=t.length;e<n;e++)if(fn(t[e]))return!0;return!1}if(ln(t))return!0;if(t.toJSON&&"function"==typeof t.toJSON&&1===arguments.length)return fn(t.toJSON(),!0);for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e)&&fn(t[e]))return!0;return!1}function dn(t){const e=[],n=t.data,r=t;return r.data=pn(n,e),r.attachments=e.length,{packet:r,buffers:e}}function pn(t,e){if(!t)return t;if(ln(t)){const n={_placeholder:!0,num:e.length};return e.push(t),n}if(Array.isArray(t)){const n=new Array(t.length);for(let r=0;r<t.length;r++)n[r]=pn(t[r],e);return n}if("object"==typeof t&&!(t instanceof Date)){const n={};for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=pn(t[r],e));return n}return t}function yn(t,e){return t.data=vn(t.data,e),delete t.attachments,t}function vn(t,e){if(!t)return t;if(t&&!0===t._placeholder){if("number"==typeof t.num&&t.num>=0&&t.num<e.length)return e[t.num];throw new Error("illegal attachments")}if(Array.isArray(t))for(let n=0;n<t.length;n++)t[n]=vn(t[n],e);else if("object"==typeof t)for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&(t[n]=vn(t[n],e));return t}const gn=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],mn=5;var bn;!function(t){t[t.CONNECT=0]="CONNECT",t[t.DISCONNECT=1]="DISCONNECT",t[t.EVENT=2]="EVENT",t[t.ACK=3]="ACK",t[t.CONNECT_ERROR=4]="CONNECT_ERROR",t[t.BINARY_EVENT=5]="BINARY_EVENT",t[t.BINARY_ACK=6]="BINARY_ACK"}(bn||(bn={}));class wn{constructor(t){this.replacer=t}encode(t){return t.type!==bn.EVENT&&t.type!==bn.ACK||!fn(t)?[this.encodeAsString(t)]:this.encodeAsBinary({type:t.type===bn.EVENT?bn.BINARY_EVENT:bn.BINARY_ACK,nsp:t.nsp,data:t.data,id:t.id})}encodeAsString(t){let e=""+t.type;return t.type!==bn.BINARY_EVENT&&t.type!==bn.BINARY_ACK||(e+=t.attachments+"-"),t.nsp&&"/"!==t.nsp&&(e+=t.nsp+","),null!=t.id&&(e+=t.id),null!=t.data&&(e+=JSON.stringify(t.data,this.replacer)),e}encodeAsBinary(t){const e=dn(t),n=this.encodeAsString(e.packet),r=e.buffers;return r.unshift(n),r}}function Sn(t){return"[object Object]"===Object.prototype.toString.call(t)}class En extends Ne{constructor(t){super(),this.reviver=t}add(t){let e;if("string"==typeof t){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");e=this.decodeString(t);const n=e.type===bn.BINARY_EVENT;n||e.type===bn.BINARY_ACK?(e.type=n?bn.EVENT:bn.ACK,this.reconstructor=new xn(e),0===e.attachments&&super.emitReserved("decoded",e)):super.emitReserved("decoded",e)}else{if(!ln(t)&&!t.base64)throw new Error("Unknown type: "+t);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");e=this.reconstructor.takeBinaryData(t),e&&(this.reconstructor=null,super.emitReserved("decoded",e))}}decodeString(t){let e=0;const n={type:Number(t.charAt(0))};if(void 0===bn[n.type])throw new Error("unknown packet type "+n.type);if(n.type===bn.BINARY_EVENT||n.type===bn.BINARY_ACK){const r=e+1;for(;"-"!==t.charAt(++e)&&e!=t.length;);const i=t.substring(r,e);if(i!=Number(i)||"-"!==t.charAt(e))throw new Error("Illegal attachments");n.attachments=Number(i)}if("/"===t.charAt(e+1)){const r=e+1;for(;++e&&","!==t.charAt(e)&&e!==t.length;);n.nsp=t.substring(r,e)}else n.nsp="/";const r=t.charAt(e+1);if(""!==r&&Number(r)==r){const r=e+1;for(;++e;){const n=t.charAt(e);if(null==n||Number(n)!=n){--e;break}if(e===t.length)break}n.id=Number(t.substring(r,e+1))}if(t.charAt(++e)){const r=this.tryParse(t.substr(e));if(!En.isPayloadValid(n.type,r))throw new Error("invalid payload");n.data=r}return n}tryParse(t){try{return JSON.parse(t,this.reviver)}catch(t){return!1}}static isPayloadValid(t,e){switch(t){case bn.CONNECT:return Sn(e);case bn.DISCONNECT:return void 0===e;case bn.CONNECT_ERROR:return"string"==typeof e||Sn(e);case bn.EVENT:case bn.BINARY_EVENT:return Array.isArray(e)&&("number"==typeof e[0]||"string"==typeof e[0]&&-1===gn.indexOf(e[0]));case bn.ACK:case bn.BINARY_ACK:return Array.isArray(e)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class xn{constructor(t){this.packet=t,this.buffers=[],this.reconPack=t}takeBinaryData(t){if(this.buffers.push(t),this.buffers.length===this.reconPack.attachments){const t=yn(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}function _n(t,e,n){return t.on(e,n),function(){t.off(e,n)}}const kn=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Tn extends Ne{constructor(t,e,n){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=t,this.nsp=e,n&&n.auth&&(this.auth=n.auth),this._opts=Object.assign({},n),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const t=this.io;this.subs=[_n(t,"open",this.onopen.bind(this)),_n(t,"packet",this.onpacket.bind(this)),_n(t,"error",this.onerror.bind(this)),_n(t,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(...t){return t.unshift("message"),this.emit.apply(this,t),this}emit(t,...e){if(kn.hasOwnProperty(t))throw new Error('"'+t.toString()+'" is a reserved event name');if(e.unshift(t),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(e),this;const n={type:bn.EVENT,data:e,options:{}};if(n.options.compress=!1!==this.flags.compress,"function"==typeof e[e.length-1]){const t=this.ids++,r=e.pop();this._registerAckCallback(t,r),n.id=t}const r=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!r||!this.connected)||(this.connected?(this.notifyOutgoingListeners(n),this.packet(n)):this.sendBuffer.push(n)),this.flags={},this}_registerAckCallback(t,e){var n;const r=null!==(n=this.flags.timeout)&&void 0!==n?n:this._opts.ackTimeout;if(void 0===r)return void(this.acks[t]=e);const i=this.io.setTimeoutFn((()=>{delete this.acks[t];for(let e=0;e<this.sendBuffer.length;e++)this.sendBuffer[e].id===t&&this.sendBuffer.splice(e,1);e.call(this,new Error("operation has timed out"))}),r),o=(...t)=>{this.io.clearTimeoutFn(i),e.apply(this,t)};o.withError=!0,this.acks[t]=o}emitWithAck(t,...e){return new Promise(((n,r)=>{const i=(t,e)=>t?r(t):n(e);i.withError=!0,e.push(i),this.emit(t,...e)}))}_addToQueue(t){let e;"function"==typeof t[t.length-1]&&(e=t.pop());const n={id:this._queueSeq++,tryCount:0,pending:!1,args:t,flags:Object.assign({fromQueue:!0},this.flags)};t.push(((t,...r)=>{if(n===this._queue[0])return null!==t?n.tryCount>this._opts.retries&&(this._queue.shift(),e&&e(t)):(this._queue.shift(),e&&e(null,...r)),n.pending=!1,this._drainQueue()})),this._queue.push(n),this._drainQueue()}_drainQueue(t=!1){if(!this.connected||0===this._queue.length)return;const e=this._queue[0];e.pending&&!t||(e.pending=!0,e.tryCount++,this.flags=e.flags,this.emit.apply(this,e.args))}packet(t){t.nsp=this.nsp,this.io._packet(t)}onopen(){"function"==typeof this.auth?this.auth((t=>{this._sendConnectPacket(t)})):this._sendConnectPacket(this.auth)}_sendConnectPacket(t){this.packet({type:bn.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},t):t})}onerror(t){this.connected||this.emitReserved("connect_error",t)}onclose(t,e){this.connected=!1,delete this.id,this.emitReserved("disconnect",t,e),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach((t=>{if(!this.sendBuffer.some((e=>String(e.id)===t))){const e=this.acks[t];delete this.acks[t],e.withError&&e.call(this,new Error("socket has been disconnected"))}}))}onpacket(t){if(t.nsp===this.nsp)switch(t.type){case bn.CONNECT:t.data&&t.data.sid?this.onconnect(t.data.sid,t.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case bn.EVENT:case bn.BINARY_EVENT:this.onevent(t);break;case bn.ACK:case bn.BINARY_ACK:this.onack(t);break;case bn.DISCONNECT:this.ondisconnect();break;case bn.CONNECT_ERROR:this.destroy();const e=new Error(t.data.message);e.data=t.data.data,this.emitReserved("connect_error",e)}}onevent(t){const e=t.data||[];null!=t.id&&e.push(this.ack(t.id)),this.connected?this.emitEvent(e):this.receiveBuffer.push(Object.freeze(e))}emitEvent(t){if(this._anyListeners&&this._anyListeners.length){const e=this._anyListeners.slice();for(const n of e)n.apply(this,t)}super.emit.apply(this,t),this._pid&&t.length&&"string"==typeof t[t.length-1]&&(this._lastOffset=t[t.length-1])}ack(t){const e=this;let n=!1;return function(...r){n||(n=!0,e.packet({type:bn.ACK,id:t,data:r}))}}onack(t){const e=this.acks[t.id];"function"==typeof e&&(delete this.acks[t.id],e.withError&&t.data.unshift(null),e.apply(this,t.data))}onconnect(t,e){this.id=t,this.recovered=e&&this._pid===e,this._pid=e,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach((t=>this.emitEvent(t))),this.receiveBuffer=[],this.sendBuffer.forEach((t=>{this.notifyOutgoingListeners(t),this.packet(t)})),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach((t=>t())),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:bn.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(t){return this.flags.compress=t,this}get volatile(){return this.flags.volatile=!0,this}timeout(t){return this.flags.timeout=t,this}onAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(t),this}prependAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(t),this}offAny(t){if(!this._anyListeners)return this;if(t){const e=this._anyListeners;for(let n=0;n<e.length;n++)if(t===e[n])return e.splice(n,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(t),this}prependAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(t),this}offAnyOutgoing(t){if(!this._anyOutgoingListeners)return this;if(t){const e=this._anyOutgoingListeners;for(let n=0;n<e.length;n++)if(t===e[n])return e.splice(n,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(t){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const e=this._anyOutgoingListeners.slice();for(const n of e)n.apply(this,t.data)}}}function On(t){t=t||{},this.ms=t.min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}On.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),n=Math.floor(e*this.jitter*t);t=0==(1&Math.floor(10*e))?t-n:t+n}return 0|Math.min(t,this.max)},On.prototype.reset=function(){this.attempts=0},On.prototype.setMin=function(t){this.ms=t},On.prototype.setMax=function(t){this.max=t},On.prototype.setJitter=function(t){this.jitter=t};class Nn extends Ne{constructor(t,n){var r;super(),this.nsps={},this.subs=[],t&&"object"==typeof t&&(n=t,t=void 0),(n=n||{}).path=n.path||"/socket.io",this.opts=n,je(this,n),this.reconnection(!1!==n.reconnection),this.reconnectionAttempts(n.reconnectionAttempts||1/0),this.reconnectionDelay(n.reconnectionDelay||1e3),this.reconnectionDelayMax(n.reconnectionDelayMax||5e3),this.randomizationFactor(null!==(r=n.randomizationFactor)&&void 0!==r?r:.5),this.backoff=new On({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==n.timeout?2e4:n.timeout),this._readyState="closed",this.uri=t;const i=n.parser||e;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=!1!==n.autoConnect,this._autoConnect&&this.open()}reconnection(t){return arguments.length?(this._reconnection=!!t,this):this._reconnection}reconnectionAttempts(t){return void 0===t?this._reconnectionAttempts:(this._reconnectionAttempts=t,this)}reconnectionDelay(t){var e;return void 0===t?this._reconnectionDelay:(this._reconnectionDelay=t,null===(e=this.backoff)||void 0===e||e.setMin(t),this)}randomizationFactor(t){var e;return void 0===t?this._randomizationFactor:(this._randomizationFactor=t,null===(e=this.backoff)||void 0===e||e.setJitter(t),this)}reconnectionDelayMax(t){var e;return void 0===t?this._reconnectionDelayMax:(this._reconnectionDelayMax=t,null===(e=this.backoff)||void 0===e||e.setMax(t),this)}timeout(t){return arguments.length?(this._timeout=t,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(t){if(~this._readyState.indexOf("open"))return this;this.engine=new on(this.uri,this.opts);const e=this.engine,n=this;this._readyState="opening",this.skipReconnect=!1;const r=_n(e,"open",(function(){n.onopen(),t&&t()})),i=e=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",e),t?t(e):this.maybeReconnectOnOpen()},o=_n(e,"error",i);if(!1!==this._timeout){const t=this._timeout,n=this.setTimeoutFn((()=>{r(),i(new Error("timeout")),e.close()}),t);this.opts.autoUnref&&n.unref(),this.subs.push((()=>{this.clearTimeoutFn(n)}))}return this.subs.push(r),this.subs.push(o),this}connect(t){return this.open(t)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const t=this.engine;this.subs.push(_n(t,"ping",this.onping.bind(this)),_n(t,"data",this.ondata.bind(this)),_n(t,"error",this.onerror.bind(this)),_n(t,"close",this.onclose.bind(this)),_n(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(t){try{this.decoder.add(t)}catch(t){this.onclose("parse error",t)}}ondecoded(t){Xe((()=>{this.emitReserved("packet",t)}),this.setTimeoutFn)}onerror(t){this.emitReserved("error",t)}socket(t,e){let n=this.nsps[t];return n?this._autoConnect&&!n.active&&n.connect():(n=new Tn(this,t,e),this.nsps[t]=n),n}_destroy(t){const e=Object.keys(this.nsps);for(const t of e)if(this.nsps[t].active)return;this._close()}_packet(t){const e=this.encoder.encode(t);for(let n=0;n<e.length;n++)this.engine.write(e[n],t.options)}cleanup(){this.subs.forEach((t=>t())),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(t,e){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",t,e),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const t=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const e=this.backoff.duration();this._reconnecting=!0;const n=this.setTimeoutFn((()=>{t.skipReconnect||(this.emitReserved("reconnect_attempt",t.backoff.attempts),t.skipReconnect||t.open((e=>{e?(t._reconnecting=!1,t.reconnect(),this.emitReserved("reconnect_error",e)):t.onreconnect()})))}),e);this.opts.autoUnref&&n.unref(),this.subs.push((()=>{this.clearTimeoutFn(n)}))}}onreconnect(){const t=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",t)}}const An={};function Rn(t,e){"object"==typeof t&&(e=t,t=void 0);const n=function(t,e="",n){let r=t;n=n||"undefined"!=typeof location&&location,null==t&&(t=n.protocol+"//"+n.host),"string"==typeof t&&("/"===t.charAt(0)&&(t="/"===t.charAt(1)?n.protocol+t:n.host+t),/^(https?|wss?):\/\//.test(t)||(t=void 0!==n?n.protocol+"//"+t:"https://"+t),r=rn(t)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";const i=-1!==r.host.indexOf(":")?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+i+":"+r.port+e,r.href=r.protocol+"://"+i+(n&&n.port===r.port?"":":"+r.port),r}(t,(e=e||{}).path||"/socket.io"),r=n.source,i=n.id,o=n.path,s=An[i]&&o in An[i].nsps;let a;return e.forceNew||e["force new connection"]||!1===e.multiplex||s?a=new Nn(r,e):(An[i]||(An[i]=new Nn(r,e)),a=An[i]),n.query&&!e.query&&(e.query=n.queryKey),a.socket(n.path,e)}Object.assign(Rn,{Manager:Nn,Socket:Tn,io:Rn,connect:Rn});var Ln=function(t){return t instanceof Error?t.message:"string"==typeof t?t:JSON.stringify(t)};function In(t){return In="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},In(t)}function jn(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,o,s,a=[],c=!0,u=!1;try{if(o=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=o.call(n)).done)&&(a.push(r.value),a.length!==e);c=!0);}catch(t){u=!0,i=t}finally{try{if(!c&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(u)throw i}}return a}}(t,e)||function(t,e){if(t){if("string"==typeof t)return Cn(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Cn(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Cn(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Pn(){Pn=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,i=Object.defineProperty||function(t,e,n){t[e]=n.value},o="function"==typeof Symbol?Symbol:{},s=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function u(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,n){return t[e]=n}}function h(t,e,n,r){var o=e&&e.prototype instanceof g?e:g,s=Object.create(o.prototype),a=new R(r||[]);return i(s,"_invoke",{value:T(t,n,a)}),s}function l(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=h;var f="suspendedStart",d="suspendedYield",p="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};u(w,s,(function(){return this}));var S=Object.getPrototypeOf,E=S&&S(S(L([])));E&&E!==n&&r.call(E,s)&&(w=E);var x=b.prototype=g.prototype=Object.create(w);function _(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function n(i,o,s,a){var c=l(t[i],t,o);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==In(h)&&r.call(h,"__await")?e.resolve(h.__await).then((function(t){n("next",t,s,a)}),(function(t){n("throw",t,s,a)})):e.resolve(h).then((function(t){u.value=t,s(u)}),(function(t){return n("throw",t,s,a)}))}a(c.arg)}var o;i(this,"_invoke",{value:function(t,r){function i(){return new e((function(e,i){n(t,r,e,i)}))}return o=o?o.then(i,i):i()}})}function T(e,n,r){var i=f;return function(o,s){if(i===p)throw new Error("Generator is already running");if(i===y){if("throw"===o)throw s;return{value:t,done:!0}}for(r.method=o,r.arg=s;;){var a=r.delegate;if(a){var c=O(a,r);if(c){if(c===v)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===f)throw i=y,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=p;var u=l(e,n,r);if("normal"===u.type){if(i=r.done?y:d,u.arg===v)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(i=y,r.method="throw",r.arg=u.arg)}}}function O(e,n){var r=n.method,i=e.iterator[r];if(i===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,O(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),v;var o=l(i,e.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,v;var s=o.arg;return s?s.done?(n[e.resultName]=s.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,v):s:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,v)}function N(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function R(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(N,this),this.reset(!0)}function L(e){if(e||""===e){var n=e[s];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function n(){for(;++i<e.length;)if(r.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return o.next=o}}throw new TypeError(In(e)+" is not iterable")}return m.prototype=b,i(x,"constructor",{value:b,configurable:!0}),i(b,"constructor",{value:m,configurable:!0}),m.displayName=u(b,c,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,u(t,c,"GeneratorFunction")),t.prototype=Object.create(x),t},e.awrap=function(t){return{__await:t}},_(k.prototype),u(k.prototype,a,(function(){return this})),e.AsyncIterator=k,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var s=new k(h(t,n,r,i),o);return e.isGeneratorFunction(n)?s:s.next().then((function(t){return t.done?t.value:s.next()}))},_(x),u(x,c,"Generator"),u(x,s,(function(){return this})),u(x,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=L,R.prototype={constructor:R,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function i(r,i){return a.type="throw",a.arg=e,n.next=r,i&&(n.method="next",n.arg=t),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var s=this.tryEntries[o],a=s.completion;if("root"===s.tryLoc)return i("end");if(s.tryLoc<=this.prev){var c=r.call(s,"catchLoc"),u=r.call(s,"finallyLoc");if(c&&u){if(this.prev<s.catchLoc)return i(s.catchLoc,!0);if(this.prev<s.finallyLoc)return i(s.finallyLoc)}else if(c){if(this.prev<s.catchLoc)return i(s.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return i(s.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=t,s.arg=e,o?(this.method="next",this.next=o.finallyLoc,v):this.complete(s)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),A(n),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;A(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:L(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),v}},e}function Mn(t,e,n,r,i,o,s){try{var a=t[o](s),c=a.value}catch(t){return void n(t)}a.done?e(c):Promise.resolve(c).then(r,i)}function Bn(t){return function(){var e=this,n=arguments;return new Promise((function(r,i){var o=t.apply(e,n);function s(t){Mn(o,r,i,s,a,"next",t)}function a(t){Mn(o,r,i,s,a,"throw",t)}s(void 0)}))}}var Dn="".concat("https://api.joblander.app","/user"),Un="".concat("https://api.joblander.app","/auth/signin"),Fn="".concat("https://api.joblander.app","/auth/verify-session"),Vn="".concat("https://api.joblander.app","/auth/signout"),Gn=function(){var t=Bn(Pn().mark((function t(e){return Pn().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,n){var r=chrome.runtime.getURL(e);chrome.runtime.getContexts({contextTypes:[chrome.runtime.ContextType.OFFSCREEN_DOCUMENT],documentUrls:[r]}).then((function(e){t(e.length>0)})).catch((function(t){return n(t)}))})));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),qn=function(){var t=Bn(Pn().mark((function t(){var e,n,r;return Pn().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,chrome.tabs.query({active:!0,currentWindow:!0});case 3:if(e=t.sent,n=jn(e,1),r=n[0],i=null==r?void 0:r.url,o=void 0,s=void 0,a=void 0,s=null===(o=chrome.runtime.getManifest().content_scripts)||void 0===o?void 0:o[0].matches,a=function(t,e){if(!t||!e)return!1;var n=new URL(t),r=n.host+n.pathname;return e.some((function(t){var e=t.replace(/^[^:]+:\/\//,"").replace(/\*/g,".*");return new RegExp("^"+e+"$").test(r)}))}(i,s),console.log("hasMatched",i,s,a),!a){t.next=8;break}return t.abrupt("return",r);case 8:c("Active tab is not allowed to run the extension"),t.next=14;break;case 11:t.prev=11,t.t0=t.catch(0),c("Failed to get the active tab. "+Ln(t.t0));case 14:case"end":return t.stop()}var i,o,s,a}),t,null,[[0,11]])})));return function(){return t.apply(this,arguments)}}(),Hn=function(t){var e=t.language,n=t.jobPosition,r=t.email,i=t.oauthToken,o=t.userBalanceMin;e&&n?vr.send({type:"SET_USER_SETTINGS",email:r,userBalanceMin:o,oauthToken:i,userSettings:{language:e,jobPosition:n}}):c("setUserSettings: language or jobPosition is undefined")},Wn=function(t){t?vr.send({type:"SET_TAB_ID",tabId:t}):c("setTabId: tabId is undefined")},Jn=function(){var t=Bn(Pn().mark((function t(e){return Pn().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,n){chrome.storage.local.get([e],(function(r){void 0===r[e]?n():t(r[e])}))})));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),zn=function(){var t=Bn(Pn().mark((function t(e){var n,r,i,o,s,a,c;return Pn().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.isInteractive,r=e.shouldCreateNewUser,i=e.settings,t.prev=1,t.next=4,chrome.identity.getAuthToken({interactive:n});case 4:if((o=t.sent).token){t.next=8;break}return chrome.runtime.sendMessage({type:ae.AUTH_ERROR,error:"Failed to get OAuth token"}),t.abrupt("return",null);case 8:return t.next=10,fetch(Un,{method:"POST",headers:{Authorization:"Bearer ".concat(o.token),"Content-Type":"application/json"},body:JSON.stringify({shouldCreateNewUser:r,settings:i})});case 10:if((s=t.sent).ok){t.next=16;break}return t.next=14,s.json();case 14:a=t.sent,chrome.runtime.sendMessage({type:ae.AUTH_ERROR,error:"Sign-in failed. "+Ln(a)});case 16:return t.next=18,s.json();case 18:return c=t.sent,chrome.runtime.sendMessage({type:ae.SIGNED_IN,data:c}),t.abrupt("return",c);case 23:return t.prev=23,t.t0=t.catch(1),chrome.runtime.sendMessage({type:ae.AUTH_ERROR,error:"Sign-in failed. "+Ln(t.t0)}),t.abrupt("return",null);case 27:case"end":return t.stop()}}),t,null,[[1,23]])})));return function(e){return t.apply(this,arguments)}}(),Yn=function(){var t=Bn(Pn().mark((function t(e){var n,r,i,o,s;return Pn().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.language,r=e.jobPosition,i=e.email,t.prev=1,t.next=4,fetch(Dn,{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({language:n,jobPosition:r,email:i})});case 4:if((o=t.sent).ok){t.next=7;break}throw new Error("Failed to update user settings");case 7:return t.next=9,o.json();case 9:return s=t.sent,t.abrupt("return",s);case 13:return t.prev=13,t.t0=t.catch(1),c("Failed to update user settings:",t.t0),t.abrupt("return",null);case 17:case"end":return t.stop()}}),t,null,[[1,13]])})));return function(e){return t.apply(this,arguments)}}(),$n=function(){var t=Bn(Pn().mark((function t(e){return Pn().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:vr.start(),Hn({language:e.settings.language,jobPosition:e.settings.jobPosition,email:e.email,oauthToken:e.oauthToken,userBalanceMin:e.usageMinutes});case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),Kn=function(){var t=Bn(Pn().mark((function t(){var e,n;return Pn().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,fetch(Fn,{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"});case 3:if((e=t.sent).ok){t.next=7;break}return chrome.runtime.sendMessage({type:ae.AUTH_ERROR,error:"Session verification failed"}),t.abrupt("return",!1);case 7:return t.next=9,e.json();case 9:return n=t.sent,chrome.runtime.sendMessage({type:ae.SIGNED_IN,data:n}),t.abrupt("return",n);case 14:return t.prev=14,t.t0=t.catch(0),c("verify failed with error",t.t0),chrome.runtime.sendMessage({type:ae.AUTH_ERROR,error:"Session verification failed. "+Ln(t.t0)}),t.abrupt("return",!1);case 19:case"end":return t.stop()}}),t,null,[[0,14]])})));return function(){return t.apply(this,arguments)}}(),Xn=function(){var t=Bn(Pn().mark((function t(e){return Pn().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return null!=e&&e.email||chrome.runtime.sendMessage({type:ae.AUTH_ERROR,error:"Email is required to sign out"}),t.prev=1,t.next=4,fetch(Vn,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include"});case 4:if(t.sent.ok){t.next=7;break}throw new Error("Failed to sign out");case 7:t.next=13;break;case 9:t.prev=9,t.t0=t.catch(1),c("Failed to sign out:",t.t0),chrome.runtime.sendMessage({type:ae.AUTH_ERROR,error:"Failed to sign out"});case 13:case"end":return t.stop()}}),t,null,[[1,9]])})));return function(e){return t.apply(this,arguments)}}(),Qn=function(){var t=Bn(Pn().mark((function t(e){var n,r,i,o,s;return Pn().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n="6440201276:AAGwyK3B_PQ50GiTSTkXFEmTpOomTV-2gCU",r=0,i=["767616895","101333337"];case 3:if(!(r<i.length)){t.next=18;break}return o=i[r],t.prev=5,t.next=8,fetch("https://api.telegram.org/bot".concat(n,"/sendMessage"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chat_id:o,text:e})});case 8:(s=t.sent).ok||console.error("sendTelegramNotification HTTP error! status: ".concat(s.status)),t.next=15;break;case 12:t.prev=12,t.t0=t.catch(5),console.error("sendTelegramNotification Error sending message:",t.t0);case 15:r++,t.next=3;break;case 18:case"end":return t.stop()}}),t,null,[[5,12]])})));return function(e){return t.apply(this,arguments)}}();function Zn(t){return Zn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Zn(t)}function tr(){tr=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,i=Object.defineProperty||function(t,e,n){t[e]=n.value},o="function"==typeof Symbol?Symbol:{},s=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function u(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,n){return t[e]=n}}function h(t,e,n,r){var o=e&&e.prototype instanceof g?e:g,s=Object.create(o.prototype),a=new R(r||[]);return i(s,"_invoke",{value:T(t,n,a)}),s}function l(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=h;var f="suspendedStart",d="suspendedYield",p="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};u(w,s,(function(){return this}));var S=Object.getPrototypeOf,E=S&&S(S(L([])));E&&E!==n&&r.call(E,s)&&(w=E);var x=b.prototype=g.prototype=Object.create(w);function _(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function n(i,o,s,a){var c=l(t[i],t,o);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==Zn(h)&&r.call(h,"__await")?e.resolve(h.__await).then((function(t){n("next",t,s,a)}),(function(t){n("throw",t,s,a)})):e.resolve(h).then((function(t){u.value=t,s(u)}),(function(t){return n("throw",t,s,a)}))}a(c.arg)}var o;i(this,"_invoke",{value:function(t,r){function i(){return new e((function(e,i){n(t,r,e,i)}))}return o=o?o.then(i,i):i()}})}function T(e,n,r){var i=f;return function(o,s){if(i===p)throw new Error("Generator is already running");if(i===y){if("throw"===o)throw s;return{value:t,done:!0}}for(r.method=o,r.arg=s;;){var a=r.delegate;if(a){var c=O(a,r);if(c){if(c===v)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===f)throw i=y,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=p;var u=l(e,n,r);if("normal"===u.type){if(i=r.done?y:d,u.arg===v)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(i=y,r.method="throw",r.arg=u.arg)}}}function O(e,n){var r=n.method,i=e.iterator[r];if(i===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,O(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),v;var o=l(i,e.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,v;var s=o.arg;return s?s.done?(n[e.resultName]=s.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,v):s:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,v)}function N(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function R(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(N,this),this.reset(!0)}function L(e){if(e||""===e){var n=e[s];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function n(){for(;++i<e.length;)if(r.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return o.next=o}}throw new TypeError(Zn(e)+" is not iterable")}return m.prototype=b,i(x,"constructor",{value:b,configurable:!0}),i(b,"constructor",{value:m,configurable:!0}),m.displayName=u(b,c,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,u(t,c,"GeneratorFunction")),t.prototype=Object.create(x),t},e.awrap=function(t){return{__await:t}},_(k.prototype),u(k.prototype,a,(function(){return this})),e.AsyncIterator=k,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var s=new k(h(t,n,r,i),o);return e.isGeneratorFunction(n)?s:s.next().then((function(t){return t.done?t.value:s.next()}))},_(x),u(x,c,"Generator"),u(x,s,(function(){return this})),u(x,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=L,R.prototype={constructor:R,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function i(r,i){return a.type="throw",a.arg=e,n.next=r,i&&(n.method="next",n.arg=t),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var s=this.tryEntries[o],a=s.completion;if("root"===s.tryLoc)return i("end");if(s.tryLoc<=this.prev){var c=r.call(s,"catchLoc"),u=r.call(s,"finallyLoc");if(c&&u){if(this.prev<s.catchLoc)return i(s.catchLoc,!0);if(this.prev<s.finallyLoc)return i(s.finallyLoc)}else if(c){if(this.prev<s.catchLoc)return i(s.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return i(s.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=t,s.arg=e,o?(this.method="next",this.next=o.finallyLoc,v):this.complete(s)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),A(n),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;A(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:L(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),v}},e}function er(t,e,n,r,i,o,s){try{var a=t[o](s),c=a.value}catch(t){return void n(t)}a.done?e(c):Promise.resolve(c).then(r,i)}function nr(t){return function(){var e=this,n=arguments;return new Promise((function(r,i){var o=t.apply(e,n);function s(t){er(o,r,i,s,a,"next",t)}function a(t){er(o,r,i,s,a,"throw",t)}s(void 0)}))}}var rr=function(){var t=nr(tr().mark((function t(e){var n;return tr().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,n="recorder.html",t.next=4,Gn(n);case 4:if(t.sent){t.next=8;break}return t.next=8,chrome.offscreen.createDocument({url:n,reasons:["USER_MEDIA"],justification:"Document to record user media"});case 8:if(null==e||!e.streamId){t.next=11;break}return chrome.runtime.sendMessage({type:se.START,target:"offscreen",data:{streamId:null==e?void 0:e.streamId}}),t.abrupt("return");case 11:t.next=16;break;case 13:return t.prev=13,t.t0=t.catch(0),t.abrupt("return",Ln(t.t0));case 16:case"end":return t.stop()}}),t,null,[[0,13]])})));return function(e){return t.apply(this,arguments)}}(),ir=function(){var t=nr(tr().mark((function t(e){var n;return tr().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.email){t.next=2;break}return t.abrupt("return",Promise.reject("Email is not defined"));case 2:return t.next=4,Jn("tabURL");case 4:return n=t.sent,t.abrupt("return",new Promise((function(t,r){var i=Rn("https://api.joblander.app",{transports:["websocket"],auth:{token:e.oauthToken},query:{language:e.language,jobPosition:e.jobPosition,email:e.email,tabURL:n}});i.on(l.CONNECT,(function(){a("Connected to WebSocket server","https://api.joblander.app"),t(i)})),i.on(l.DISCONNECT,(function(){u("Disconnected from WebSocket server"),vr.send({type:"RESET"})})),i.on(l.ERROR,(function(t){c("WebSocket Error:",t),vr.send({type:"ERROR",error:Ln(t)}),r(Ln(t))})),i.on(l.CONNECT_ERROR,(function(t){c("Failed to connect to server: ".concat(t)),r(Ln(t))})),i.on(l.MAIN_MESSAGE,(function(t){null!=e&&e.tabId&&chrome.tabs.sendMessage(null==e?void 0:e.tabId,t)})),i.on(l.PROCESSING,(function(t){e.tabId&&chrome.tabs.sendMessage(e.tabId,{type:l.PROCESSING,source:t.source})})),i.on(l.RECEIVING,(function(t){e.tabId&&chrome.tabs.sendMessage(e.tabId,{type:l.RECEIVING,source:t.source})}))})));case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();function or(t){return or="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},or(t)}function sr(){sr=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,i=Object.defineProperty||function(t,e,n){t[e]=n.value},o="function"==typeof Symbol?Symbol:{},s=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function u(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,n){return t[e]=n}}function h(t,e,n,r){var o=e&&e.prototype instanceof g?e:g,s=Object.create(o.prototype),a=new R(r||[]);return i(s,"_invoke",{value:T(t,n,a)}),s}function l(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=h;var f="suspendedStart",d="suspendedYield",p="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};u(w,s,(function(){return this}));var S=Object.getPrototypeOf,E=S&&S(S(L([])));E&&E!==n&&r.call(E,s)&&(w=E);var x=b.prototype=g.prototype=Object.create(w);function _(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function n(i,o,s,a){var c=l(t[i],t,o);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==or(h)&&r.call(h,"__await")?e.resolve(h.__await).then((function(t){n("next",t,s,a)}),(function(t){n("throw",t,s,a)})):e.resolve(h).then((function(t){u.value=t,s(u)}),(function(t){return n("throw",t,s,a)}))}a(c.arg)}var o;i(this,"_invoke",{value:function(t,r){function i(){return new e((function(e,i){n(t,r,e,i)}))}return o=o?o.then(i,i):i()}})}function T(e,n,r){var i=f;return function(o,s){if(i===p)throw new Error("Generator is already running");if(i===y){if("throw"===o)throw s;return{value:t,done:!0}}for(r.method=o,r.arg=s;;){var a=r.delegate;if(a){var c=O(a,r);if(c){if(c===v)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===f)throw i=y,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=p;var u=l(e,n,r);if("normal"===u.type){if(i=r.done?y:d,u.arg===v)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(i=y,r.method="throw",r.arg=u.arg)}}}function O(e,n){var r=n.method,i=e.iterator[r];if(i===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,O(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),v;var o=l(i,e.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,v;var s=o.arg;return s?s.done?(n[e.resultName]=s.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,v):s:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,v)}function N(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function R(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(N,this),this.reset(!0)}function L(e){if(e||""===e){var n=e[s];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function n(){for(;++i<e.length;)if(r.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return o.next=o}}throw new TypeError(or(e)+" is not iterable")}return m.prototype=b,i(x,"constructor",{value:b,configurable:!0}),i(b,"constructor",{value:m,configurable:!0}),m.displayName=u(b,c,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,u(t,c,"GeneratorFunction")),t.prototype=Object.create(x),t},e.awrap=function(t){return{__await:t}},_(k.prototype),u(k.prototype,a,(function(){return this})),e.AsyncIterator=k,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var s=new k(h(t,n,r,i),o);return e.isGeneratorFunction(n)?s:s.next().then((function(t){return t.done?t.value:s.next()}))},_(x),u(x,c,"Generator"),u(x,s,(function(){return this})),u(x,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=L,R.prototype={constructor:R,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function i(r,i){return a.type="throw",a.arg=e,n.next=r,i&&(n.method="next",n.arg=t),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var s=this.tryEntries[o],a=s.completion;if("root"===s.tryLoc)return i("end");if(s.tryLoc<=this.prev){var c=r.call(s,"catchLoc"),u=r.call(s,"finallyLoc");if(c&&u){if(this.prev<s.catchLoc)return i(s.catchLoc,!0);if(this.prev<s.finallyLoc)return i(s.finallyLoc)}else if(c){if(this.prev<s.catchLoc)return i(s.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return i(s.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=t,s.arg=e,o?(this.method="next",this.next=o.finallyLoc,v):this.complete(s)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),A(n),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;A(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:L(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),v}},e}function ar(t,e,n,r,i,o,s){try{var a=t[o](s),c=a.value}catch(t){return void n(t)}a.done?e(c):Promise.resolve(c).then(r,i)}var cr,ur,hr,lr,fr,dr,pr={email:null,oauthToken:null,socket:null,error:null,tabId:null,streamId:null,language:"en-US",jobPosition:"software engineer",isVisible:!1,userBalanceMin:0},yr=(cr={id:"serviceWorker",predictableActionArguments:!0,initial:"idle",context:pr,states:{idle:{on:{START_STREAMING:{target:"initWebSocket"}}},initWebSocket:{invoke:{id:"initWebSocket",src:ir,onDone:{target:"gettingMediaStreamId",actions:Yt({socket:function(t,e){return e.data}})},onError:{target:"error",actions:[Yt({error:function(t,e){return e.data}})]}}},gettingMediaStreamId:{invoke:{id:"getMediaStreamId",src:function(t){return new Promise((function(e,n){null!==t.tabId?chrome.tabCapture.getMediaStreamId({targetTabId:t.tabId},(function(t){var r;chrome.runtime.lastError&&n(null===(r=chrome.runtime.lastError)||void 0===r?void 0:r.message),t||n("Stream Id is not defined"),e(t)})):n("Tab ID is not defined")}))},onDone:{target:"settingUpRecorder",actions:Yt({streamId:function(t,e){return e.data}})},onError:{target:"retryGettingMediaStreamId",actions:Yt({error:function(t,e){return e.data}})}}},retryGettingMediaStreamId:{after:{500:{target:"gettingMediaStreamId"}}},settingUpRecorder:{invoke:{id:"setupRecorder",src:rr,onDone:{target:"readyToStream"},onError:{target:"error",actions:Yt({error:function(t,e){return e.data}})}}},readyToStream:{on:{STREAMING_STARTED:"streaming"}},streaming:{on:{STOP_STREAMING:"stopStreamingInitiated"}},stopStreamingInitiated:{entry:"sendStopMessageToRecorder",on:{STREAMING_STOPPED:{target:"disconnectFromTheBackend"}}},disconnectFromTheBackend:{entry:"disconnectWebSocket",always:"idle"},error:{entry:(fr=function(t){return"Error: ".concat(t.error)},void 0===fr&&(fr=Rt),{type:k,label:dr,expr:fr}),exit:Yt({error:function(){return null}})}},on:{RESET:{actions:["cleanOffscreenDocument","disconnectWebSocket","resetStateMachine","sendHideToUI",$t({type:"SET_VISIBILITY",isVisible:!1})],target:"idle"},SPEECH_END:{actions:"sendSpeechEndMessage"},SET_TAB_ID:{actions:["cleanOffscreenDocument","disconnectWebSocket","sendHideToUI","setTabId"],target:"initWebSocket"},ERROR:{target:"error",actions:Yt({error:function(t,e){return e.error}})},SET_USER_SETTINGS:{actions:Yt({language:function(t,e){return e.userSettings.language},jobPosition:function(t,e){return e.userSettings.jobPosition},email:function(t,e){return e.email},oauthToken:function(t,e){return e.oauthToken?e.oauthToken:t.oauthToken}})},SET_VISIBILITY:{actions:"toggleVisibility"}}},ur={actions:{setTabId:Yt({tabId:function(t,e){return e.tabId}}),sendHideToUI:function(t){var e=t.tabId;try{e&&chrome.tabs.sendMessage(e,{type:ce.HIDE_UI})}catch(t){c("Error sending HIDE_UI message:",Ln(t))}},sendStopMessageToRecorder:function(){try{chrome.runtime.sendMessage({type:se.STOP,target:"offscreen"})}catch(t){c("Error sending STOP message to recorder:",Ln(t))}},disconnectWebSocket:function(t){try{t.socket&&((e=t.socket).off(l.CONNECT),e.off(l.DISCONNECT),e.off(l.ERROR),e.off(l.CONNECT_ERROR),e.off(l.MAIN_MESSAGE),e.off(l.RECEIVING),t.socket.disconnect())}catch(t){c("Error on disconnecting from websocket:",Ln(t))}var e},resetStateMachine:function(){return Yt(pr)},cleanOffscreenDocument:(lr=sr().mark((function t(){return sr().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Gn("recorder.html");case 3:t.sent&&chrome.offscreen.closeDocument(),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),c("Error on closing offscreen document:",Ln(t.t0));case 10:case"end":return t.stop()}}),t,null,[[0,7]])})),hr=function(){var t=this,e=arguments;return new Promise((function(n,r){var i=lr.apply(t,e);function o(t){ar(i,n,r,o,s,"next",t)}function s(t){ar(i,n,r,o,s,"throw",t)}o(void 0)}))},function(){return hr.apply(this,arguments)}),sendSpeechEndMessage:function(t,e){var n=t.socket;try{null==n||n.emit(l.SPEECH_END,e)}catch(t){c("Error on sending SPEECH_END message:",Ln(t))}},toggleVisibility:Yt({isVisible:function(t,e){return e.isVisible}})}},P||"predictableActionArguments"in cr||zt||(zt=!0,console.warn("It is highly recommended to set `predictableActionArguments` to `true` when using `createMachine`. https://xstate.js.org/docs/guides/actions.html")),new Jt(cr,ur)),vr=oe(yr).onTransition((function(t,e){a("SW: Transitioned to ".concat(t.value),e),"ERROR"===e.type&&c("SW Error: ".concat(e.error))}));function gr(t){return gr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},gr(t)}function mr(){mr=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,i=Object.defineProperty||function(t,e,n){t[e]=n.value},o="function"==typeof Symbol?Symbol:{},s=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function u(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,n){return t[e]=n}}function h(t,e,n,r){var o=e&&e.prototype instanceof g?e:g,s=Object.create(o.prototype),a=new R(r||[]);return i(s,"_invoke",{value:T(t,n,a)}),s}function l(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=h;var f="suspendedStart",d="suspendedYield",p="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};u(w,s,(function(){return this}));var S=Object.getPrototypeOf,E=S&&S(S(L([])));E&&E!==n&&r.call(E,s)&&(w=E);var x=b.prototype=g.prototype=Object.create(w);function _(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function n(i,o,s,a){var c=l(t[i],t,o);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==gr(h)&&r.call(h,"__await")?e.resolve(h.__await).then((function(t){n("next",t,s,a)}),(function(t){n("throw",t,s,a)})):e.resolve(h).then((function(t){u.value=t,s(u)}),(function(t){return n("throw",t,s,a)}))}a(c.arg)}var o;i(this,"_invoke",{value:function(t,r){function i(){return new e((function(e,i){n(t,r,e,i)}))}return o=o?o.then(i,i):i()}})}function T(e,n,r){var i=f;return function(o,s){if(i===p)throw new Error("Generator is already running");if(i===y){if("throw"===o)throw s;return{value:t,done:!0}}for(r.method=o,r.arg=s;;){var a=r.delegate;if(a){var c=O(a,r);if(c){if(c===v)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===f)throw i=y,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=p;var u=l(e,n,r);if("normal"===u.type){if(i=r.done?y:d,u.arg===v)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(i=y,r.method="throw",r.arg=u.arg)}}}function O(e,n){var r=n.method,i=e.iterator[r];if(i===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,O(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),v;var o=l(i,e.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,v;var s=o.arg;return s?s.done?(n[e.resultName]=s.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,v):s:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,v)}function N(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function R(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(N,this),this.reset(!0)}function L(e){if(e||""===e){var n=e[s];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function n(){for(;++i<e.length;)if(r.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return o.next=o}}throw new TypeError(gr(e)+" is not iterable")}return m.prototype=b,i(x,"constructor",{value:b,configurable:!0}),i(b,"constructor",{value:m,configurable:!0}),m.displayName=u(b,c,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,u(t,c,"GeneratorFunction")),t.prototype=Object.create(x),t},e.awrap=function(t){return{__await:t}},_(k.prototype),u(k.prototype,a,(function(){return this})),e.AsyncIterator=k,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var s=new k(h(t,n,r,i),o);return e.isGeneratorFunction(n)?s:s.next().then((function(t){return t.done?t.value:s.next()}))},_(x),u(x,c,"Generator"),u(x,s,(function(){return this})),u(x,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=L,R.prototype={constructor:R,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function i(r,i){return a.type="throw",a.arg=e,n.next=r,i&&(n.method="next",n.arg=t),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var s=this.tryEntries[o],a=s.completion;if("root"===s.tryLoc)return i("end");if(s.tryLoc<=this.prev){var c=r.call(s,"catchLoc"),u=r.call(s,"finallyLoc");if(c&&u){if(this.prev<s.catchLoc)return i(s.catchLoc,!0);if(this.prev<s.finallyLoc)return i(s.finallyLoc)}else if(c){if(this.prev<s.catchLoc)return i(s.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return i(s.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=t,s.arg=e,o?(this.method="next",this.next=o.finallyLoc,v):this.complete(s)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),A(n),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;A(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:L(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),v}},e}function br(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,o,s,a=[],c=!0,u=!1;try{if(o=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=o.call(n)).done)&&(a.push(r.value),a.length!==e);c=!0);}catch(t){u=!0,i=t}finally{try{if(!c&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(u)throw i}}return a}}(t,e)||function(t,e){if(t){if("string"==typeof t)return wr(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?wr(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function wr(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Sr(t,e,n,r,i,o,s){try{var a=t[o](s),c=a.value}catch(t){return void n(t)}a.done?e(c):Promise.resolve(c).then(r,i)}function Er(t){return function(){var e=this,n=arguments;return new Promise((function(r,i){var o=t.apply(e,n);function s(t){Sr(o,r,i,s,a,"next",t)}function a(t){Sr(o,r,i,s,a,"throw",t)}s(void 0)}))}}chrome.runtime.onMessage.addListener(function(){var t=Er(mr().mark((function t(e,n,r){var i,o,s,u,f,d,p,y,v,g,m,b,w,S,E,x,_,k,T,O,N,A,R;return mr().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:i=vr.getSnapshot(),o=i.context.tabId,t.t0=e.type,t.next=t.t0===se.START?5:t.t0===se.STARTED?7:t.t0===se.STOP?9:t.t0===se.ERROR?11:t.t0===h.AUDIO?13:t.t0===l.SPEECH_END?41:t.t0===ae.SIGN_IN_GOOGLE?43:t.t0===ae.AUTO_SIGN_IN?57:t.t0===ae.SAVE_SETTINGS?64:t.t0===ae.SIGN_OUT?76:t.t0===ce.SHOW_UI?82:t.t0===ce.HIDE_UI?87:t.t0===ce.GET_UI_STATE?94:t.t0===ae.AUTH_ERROR?99:101;break;case 5:return vr.send({type:"START_STREAMING"}),t.abrupt("break",102);case 7:return vr.send({type:"STREAMING_STARTED"}),t.abrupt("break",102);case 9:return vr.send({type:"STOP_STREAMING"}),t.abrupt("break",102);case 11:return vr.send({type:"ERROR",error:Ln(e.error)}),t.abrupt("break",102);case 13:if(t.prev=13,!(s=vr.getSnapshot().context.socket)){t.next=34;break}return u=e.data,f=e.headers,t.next=20,Promise.all([fetch(u),fetch(f)]);case 20:return d=t.sent,p=br(d,2),y=p[0],v=p[1],t.next=26,Promise.all([y.blob(),v.blob()]);case 26:g=t.sent,m=br(g,2),b=m[0],w=m[1],S={type:h.AUDIO,data:b,size:b.size,source:e.source,headers:w},s.emit(l.MAIN_MESSAGE,S),t.next=35;break;case 34:c("Socket not initialized");case 35:t.next=40;break;case 37:t.prev=37,t.t1=t.catch(13),c("Error on sending audio to the backend:",t.t1);case 40:return t.abrupt("break",102);case 41:return vr.send({type:"SPEECH_END",source:e.source}),t.abrupt("break",102);case 43:return t.prev=43,t.next=46,zn({isInteractive:!0,shouldCreateNewUser:!0,settings:e.data});case 46:if(!(E=t.sent)){t.next=51;break}return t.next=50,$n(E);case 50:chrome.storage.local.set({isAutoSignIn:!0});case 51:t.next=56;break;case 53:t.prev=53,t.t2=t.catch(43),c("SW: Sign-in failed:",t.t2);case 56:return t.abrupt("break",102);case 57:return t.next=59,Kn();case 59:if(!(x=t.sent)){t.next=63;break}return t.next=63,$n(x);case 63:return t.abrupt("break",102);case 64:if(e.settings){t.next=67;break}return c("Missing required data for saving settings"),t.abrupt("break",102);case 67:return _=e.settings,k=_.language,T=_.jobPosition,O=_.email,t.next=70,Yn({email:O,language:k,jobPosition:T});case 70:if(N=t.sent){t.next=74;break}return c("Failed to update user settings"),t.abrupt("break",102);case 74:return Hn({email:O,language:k,jobPosition:T,userBalanceMin:null==N?void 0:N.usageMinutes}),t.abrupt("break",102);case 76:return t.next=78,Xn(null==e?void 0:e.data);case 78:return a("SW: Closing extension in",o),o&&chrome.tabs.sendMessage(o,{type:ce.HIDE_UI}),a("SW: Sign-out successful"),t.abrupt("break",102);case 82:return t.next=84,qn();case 84:return null!=(A=t.sent)&&A.id?(Wn(A.id),vr.send({type:"SET_VISIBILITY",isVisible:!0}),chrome.tabs.sendMessage(null==A?void 0:A.id,{type:ce.SHOW_UI})):c("SW:UIMessage.SHOW_UI: No active tab found"),t.abrupt("break",102);case 87:return vr.send({type:"SET_VISIBILITY",isVisible:!1}),t.next=90,qn();case 90:return null!=(R=t.sent)&&R.id?chrome.tabs.sendMessage(null==R?void 0:R.id,{type:ce.HIDE_UI}):c("SW:UIMessage.HIDE_UI: No active tab found"),vr.send({type:"RESET"}),t.abrupt("break",102);case 94:if((null==e?void 0:e.tabId)!==o){t.next=97;break}return r(i.context.isVisible),t.abrupt("break",102);case 97:return r(!1),t.abrupt("break",102);case 99:return o&&chrome.tabs.sendMessage(o,{type:ae.AUTH_ERROR,error:e.error}),t.abrupt("break",102);case 101:return t.abrupt("break",102);case 102:case"end":return t.stop()}}),t,null,[[13,37],[43,53]])})));return function(e,n,r){return t.apply(this,arguments)}}());var xr=!0;chrome.tabs.onUpdated.addListener((function(t,e){if(t===vr.getSnapshot().context.tabId&&"complete"===e.status){if(xr)return void(xr=!1);vr.send({type:"RESET"}),u("SW: chrome.tabs.onUpdated: sent 'RESET' to SW state machine")}})),chrome.tabs.onRemoved.addListener((function(t){t===vr.getSnapshot().context.tabId&&(vr.send({type:"RESET"}),u("SW: chrome.tabs.onRemoved: sent 'RESET' to SW state machine"))})),chrome.runtime.onSuspend.addListener((function(){vr.send({type:"RESET"}),u("SW: chrome.runtime.onSuspend: sent 'RESET' to SW state machine")})),chrome.runtime.onInstalled.addListener(function(){var t=Er(mr().mark((function t(e){return mr().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("install"!==e.reason){t.next=9;break}return t.next=3,chrome.storage.local.get("jobLanderFirstInstall");case 3:if(t.sent.jobLanderFirstInstall){t.next=9;break}return t.next=7,chrome.storage.local.set({jobLanderFirstInstall:!0});case 7:Qn("Кто-то только что установил JobLander впервые"),chrome.tabs.create({url:"https://joblander.app/first-time"});case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}();